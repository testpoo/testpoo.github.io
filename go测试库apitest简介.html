<!doctype html>
  <html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>测试铺</title>
    <link rel="stylesheet" type="text/css" href="https://testpoo.github.io/themes/css/markdown.css">
    <link rel="stylesheet" type="text/css" href="https://testpoo.github.io/themes/css/style.css">
    <link rel="shortcut icon" type="image/ico" href="https://testpoo.github.io/themes/img/favicon.ico">
  </head>

  

  <body>
    <div class="sider">
      <div class="categories">
        <div class="title">
          <a href="https://testpoo.github.io">
            <img src="https://testpoo.github.io/themes/img/title.jpg">
            <div class="linkbutton testpoo">测试铺</div>
          </a>
        </div>
        <div class="scrollheight">
          <ul>
            
            <li><a href="https://testpoo.github.io/关于我.html"><label style="color: #38b6fd"></label>&nbsp;关于我</a></li>
            
            <li><a href="https://testpoo.github.io/网址集.html"><label style="color: #38b6fd"></label>&nbsp;网址集</a></li>
            
            <li><a href="https://testpoo.github.io/问题集.html"><label style="color: #38b6fd"></label>&nbsp;问题集</a></li>
            
            <li><a href="https://testpoo.github.io/使用tar包安装mysql.html"><label style="color: #38b6fd"></label>&nbsp;技术</a></li>
            
            <li><a href="https://testpoo.github.io/debian+sway安装设置.html"><label style="color: #38b6fd"></label>&nbsp;系统安装</a></li>
            
            <li><a href="https://testpoo.github.io/人生的最高境界.html"><label style="color: #38b6fd"></label>&nbsp;摘录</a></li>
            
            <li><a href="https://testpoo.github.io/CSS代码小抄.html"><label style="color: #38b6fd"></label>&nbsp;代码小抄</a></li>
            
            <li><a href="https://testpoo.github.io/Python造假数据神器Faker.html"><label style="color: #38b6fd"></label>&nbsp;测试</a></li>
            
          </ul>
        </div>
        <div class="github"><a href="https://github.com/testpoo" target="_blank" title="GitHub:https://github.com/testpoo"></a><a href="#" title="微信号：puyaweis"></a><a href="#" title="邮箱：pu_yawei@qq.com"></a><a href="https://testpoo.github.io/rss.xml" target="_blank"></a></div>
      </div>
      <div class="articles">
        <div class="category"> 测试</div>
        <div class="scrollheight">
          <ul>
            
            <a href="https://testpoo.github.io/Python造假数据神器Faker.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;Python造假数据神器Faker</span><span>2024-02-27&nbsp;&nbsp;共47506个字</span><span class="tag">python</span><span class="tag">faker</span></li></a>
            
            <a href="https://testpoo.github.io/go测试库apitest简介.html#current"><li style="background: #f9fafb;border: 0px;" id="current"><span><label style="color: #38b6fd"></label>&nbsp;go测试库apitest简介</span><span>2023-08-23&nbsp;&nbsp;共238363个字</span><span class="tag">go</span><span class="tag">apitest</span></li></a>
            
            <a href="https://testpoo.github.io/BeautifulSoup简介.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;BeautifulSoup简介</span><span>2022-11-30&nbsp;&nbsp;共131087个字</span><span class="tag">beautifulsoup</span><span class="tag">python</span></li></a>
            
            <a href="https://testpoo.github.io/UI自动化测试神器-Cypress.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;UI自动化测试神器-Cypress</span><span>2022-06-14&nbsp;&nbsp;共55617个字</span><span class="tag">cypress</span><span class="tag">自动化测试</span></li></a>
            
            <a href="https://testpoo.github.io/如何用自动化测试搞垮团队.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;如何用自动化测试搞垮团队</span><span>2022-05-24&nbsp;&nbsp;共6145个字</span><span class="tag">自动化测试</span></li></a>
            
            <a href="https://testpoo.github.io/性能监控各指令详解.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;性能监控各指令详解</span><span>2021-12-22&nbsp;&nbsp;共131984个字</span><span class="tag">性能</span><span class="tag">监控</span></li></a>
            
            <a href="https://testpoo.github.io/nose简介.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;nose简介</span><span>2021-06-04&nbsp;&nbsp;共255429个字</span><span class="tag">nose</span><span class="tag">python</span></li></a>
            
            <a href="https://testpoo.github.io/Python自动化之unittest.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;Python自动化之unittest</span><span>2021-04-21&nbsp;&nbsp;共92705个字</span><span class="tag">python</span><span class="tag">unittest</span></li></a>
            
          </ul>
        </div>
        <div class="item-num">总共8项</div>
      </div>
    </div>
    <div class="main">
      <div class="header"><span>go测试库apitest简介</span><span>人生如逆旅，我亦是行人。<br />最后更新于2025-04-22 14:13:43</span></div>
      <input class="pswitch ponoff" type="checkbox" id="catalog">
      <div class="posts">
        <div class="toc">
<ul>
<li><a href="#1">1. 开始</a><ul>
<li><a href="#11">1.1. 概述</a></li>
<li><a href="#12">1.2. 特征</a></li>
<li><a href="#13">1.3. 安装</a></li>
<li><a href="#14">1.4. 一个测试例子的解析</a></li>
</ul>
</li>
<li><a href="#2">2. 配置</a><ul>
<li><a href="#21-debug">2.1. Debug</a></li>
<li><a href="#22-http-handler">2.2. HTTP Handler</a></li>
<li><a href="#23-hooks">2.3. Hooks</a></li>
<li><a href="#24-networking">2.4. Networking</a></li>
</ul>
</li>
<li><a href="#3">3. 请求</a><ul>
<li><a href="#31-basic-auth">3.1. Basic Auth</a></li>
<li><a href="#32-body">3.2. Body</a></li>
<li><a href="#33-cookies">3.3. Cookies</a></li>
<li><a href="#34-form">3.4. Form</a></li>
<li><a href="#35-graphql">3.5. GraphQL</a></li>
<li><a href="#36-headers">3.6. Headers</a></li>
<li><a href="#37-intercept">3.7. Intercept</a></li>
<li><a href="#38-query-params">3.8. Query Params</a></li>
</ul>
</li>
<li><a href="#4">4. 异常</a><ul>
<li><a href="#41-body">4.1. Body</a></li>
<li><a href="#42-cookies">4.2. Cookies</a></li>
<li><a href="#43">4.3. 自定义</a></li>
<li><a href="#44-headers">4.4. Headers</a></li>
<li><a href="#45-json-path">4.5. JSON Path</a></li>
<li><a href="#46-status-code">4.6. Status code</a></li>
</ul>
</li>
<li><a href="#5-mocks">5. MOCKS</a><ul>
<li><a href="#51-mocks">5.1. 定义Mocks</a></li>
<li><a href="#52-matchers">5.2. Matchers</a></li>
<li><a href="#53-standalone">5.3. Standalone</a></li>
</ul>
</li>
<li><a href="#6-integrations">6. INTEGRATIONS</a><ul>
<li><a href="#61-ginkgo">6.1. Ginkgo</a></li>
</ul>
</li>
<li><a href="#7-reports">7. REPORTS</a><ul>
<li><a href="#71-sequence-diagrams">7.1. Sequence diagrams</a></li>
</ul>
</li>
<li><a href="#8">8. 例子</a></li>
</ul>
</div>
<h3 id="1">1. 开始</h3>
<h4 id="11">1.1. 概述</h4>
<p>apitest是一个简单且可扩展的 Go 语言测试库。你可以使用 <code>apitest</code> 来简化 REST 服务、HTTP handlers(事件处理器) 和HTTP客户端的测试。</p>
<h4 id="12">1.2. 特征</h4>
<ul>
<li>
<p>可模拟外部http调用</p>
</li>
<li>
<p>在测试完成时可呈现序列图</p>
</li>
<li>
<p>可扩展——支持各种注入点</p>
</li>
<li>
<p>GraphQL（一种用于 API 的查询语言）支持</p>
</li>
<li>
<p>自定义断言函数和模拟匹配器</p>
</li>
<li>
<p>JSON路径断言，css选择器断言等等</p>
</li>
</ul>
<h4 id="13">1.3. 安装</h4>
<div class="codehilite"><pre><span></span><code>go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>github.com/steinfletcher/apitest
<span class="c1"># 使用时导入</span>
import<span class="w"> </span><span class="s2">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="c1"># 就咱们现在这种网络状态，第一种方法基本不能用，目前只能手动下载，然后手动放到GOPATH/src/github.com/下。</span>
</code></pre></div>

<p>apitest遵循语义版本控制，使用 Github 版本管理发布。</p>
<h4 id="14">1.4. 一个测试例子的解析</h4>
<p>例子主要包括三个部分</p>
<p>配置：定义将要测试的HTTP请求处理程序和所有其他特定的测试配置，例如模拟、调试模式和报告</p>
<p>请求：定义测试输入，这通常是一个http请求需要的</p>
<p>预期：定义被测应用程序应该如何响应。这通常是一个http响应需要的</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestGetMessage</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">msg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">`{&quot;message&quot;: &quot;hello&quot;}`</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">msg</span><span class="p">))</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span><span class="w"> </span><span class="c1">// 配置</span>
<span class="w">            </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span><span class="w">  </span><span class="c1">// 不通过网络进行 HTTP 调用</span>
<span class="w">            </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/message&quot;</span><span class="p">).</span><span class="w"> </span><span class="c1">// 请求，必须写</span>
<span class="w">            </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="w">       </span><span class="c1">// Expect(t).Body 匹配 HTTP 响应体</span>
<span class="w">            </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;message&quot;: &quot;hello&quot;}`</span><span class="p">).</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span><span class="w">  </span><span class="c1">// 断言http状态 http.StatusOK = 200</span>
<span class="w">            </span><span class="nx">End</span><span class="p">()</span><span class="w">  </span><span class="c1">// 测试结束</span>
<span class="p">}</span>
</code></pre></div>

<p>使用 <code>go test</code> 执行测试，<code>go test -v</code> 打印测试函数的所有细节，如下：</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>1_hello_test.go
ok<span class="w">      </span>command-line-arguments<span class="w">  </span><span class="m">0</span>.217s

<span class="o">=============================================</span>

$<span class="w"> </span>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v<span class="w"> </span>1_hello_test.go
<span class="o">===</span><span class="w"> </span>RUN<span class="w">   </span>TestGetMessage

----------&gt;<span class="w"> </span>inbound<span class="w"> </span>http<span class="w"> </span>request
GET<span class="w"> </span>/message<span class="w"> </span>HTTP/1.1
Host:<span class="w"> </span>sut



&lt;----------<span class="w"> </span>final<span class="w"> </span>response
HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Connection:<span class="w"> </span>close
Content-Type:<span class="w"> </span>text/plain<span class="p">;</span><span class="w"> </span><span class="nv">charset</span><span class="o">=</span>utf-8

<span class="o">{</span><span class="s2">&quot;message&quot;</span>:<span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="o">}</span>
Duration:<span class="w"> </span>0s

---<span class="w"> </span>PASS:<span class="w"> </span>TestGetMessage<span class="w"> </span><span class="o">(</span><span class="m">0</span>.00s<span class="o">)</span>
PASS
ok<span class="w">      </span>command-line-arguments<span class="w">  </span><span class="m">0</span>.220s5s
</code></pre></div>

<p>源文件和测试文件放在同一目录下，测试文件以 <code>_test</code> 结尾，这个是固定格式，使用 <code>go build</code> 进行编译时，<code>_test</code> 文件不会编译。每个测试函数需要以 <code>Test</code> 为前缀，每个性能测试函数需要以 <code>Benchmark</code> 为前缀。</p>
<h3 id="2">2. 配置</h3>
<p><code>APITest</code> 配置类型公开了一些方法来注册测试钩子、启用调试日志记录、并定义被测处理程序。</p>
<h4 id="21-debug">2.1. Debug</h4>
<p>启用调试日志记录并把所有请求和响应交互的http连接情况写入控制台。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">  </span><span class="nx">Debug</span><span class="p">().</span>
<span class="w">  </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">myHandler</span><span class="p">)</span>
</code></pre></div>

<p>这样会记录整个模拟交互过程，这对于定位失败测试用例背后的原因非常有用。在下面的示例中，由于模拟的 URL 不正确，导致不匹配。控制台会将每个模拟不匹配的原因记录下来。</p>
<div class="codehilite"><pre><span></span><code>----------&gt;<span class="w"> </span>inbound<span class="w"> </span>http<span class="w"> </span>request
GET<span class="w"> </span>/user<span class="w"> </span>HTTP/1.1
Host:<span class="w"> </span>application

failed<span class="w"> </span>to<span class="w"> </span>match<span class="w"> </span>mocks.<span class="w"> </span>Errors:<span class="w"> </span>received<span class="w"> </span>request<span class="w"> </span>did<span class="w"> </span>not<span class="w"> </span>match<span class="w"> </span>any<span class="w"> </span>mocks

Mock<span class="w"> </span><span class="m">1</span><span class="w"> </span>mismatches:
•<span class="w"> </span>received<span class="w"> </span>path<span class="w"> </span>/user/12345<span class="w"> </span>did<span class="w"> </span>not<span class="w"> </span>match<span class="w"> </span>mock<span class="w"> </span>path<span class="w"> </span>/preferences/12345

Mock<span class="w"> </span><span class="m">2</span><span class="w"> </span>mismatches:
•<span class="w"> </span>received<span class="w"> </span>path<span class="w"> </span>/user/12345<span class="w"> </span>did<span class="w"> </span>not<span class="w"> </span>match<span class="w"> </span>mock<span class="w"> </span>path<span class="w"> </span>/user/123456

----------&gt;<span class="w"> </span>request<span class="w"> </span>to<span class="w"> </span>mock
GET<span class="w"> </span>/user/12345<span class="w"> </span>HTTP/1.1
Host:<span class="w"> </span>localhost:8080
User-Agent:<span class="w"> </span>Go-http-client/1.1
Accept-Encoding:<span class="w"> </span>gzip
...
</code></pre></div>

<h4 id="22-http-handler">2.2. HTTP Handler</h4>
<p>应该使用 Handler 或 HandlerFunc 测试定义的 <code>handler</code>，其中 myHandler 是 一个Go的 <code>http.handler</code>。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span><span class="nx">Handler</span><span class="p">(</span><span class="nx">myHandler</span><span class="p">)</span>
</code></pre></div>

<p>设置 Handler 时，apitest 不会通过网络进行 HTTP 调用。相反，提供的 HTTP Handler 的 <code>serveHTTP</code> 方法在与测试代码相同的进程中调用。用户定义的请求和响应将通过 Go 的 <code>httptest</code> 包转换成 <code>http.Request</code> 和 <code>http.Response</code> 类型。这里的目标是测试内部应用程序而非网络。这种方法使测试既快速又简单。如果你想要用真正的 http 客户端发起一个请求去运行应用程序，则需要通过网络执行。</p>
<p>Handler 例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestHandler</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewServeMux</span><span class="p">()</span>
<span class="w">    </span><span class="nx">handler</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p>HandlerFunc 例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestHandlerFunc</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handlerFunc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">handlerFunc</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="23-hooks">2.3. Hooks</h4>
<p><strong>Intercept</strong></p>
<p>在请求调用前，<code>Intercept</code> 和 <code>Observe</code>类似。允许请求发起者将请求对象发送到被测系统之前对其进行更改。在此示例中，我们使用自定义方案设置请求参数。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestIntercept</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">RawQuery</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;a[]=xxx&amp;a[]=yyy&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;unexpected query&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Intercept</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">RawQuery</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;a[]=xxx&amp;a[]=yyy&quot;</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Observe</strong></p>
<p><code>Observe</code> 可用于在测试完成时检查请求、响应和 APITest 实例。此方法在 apitest 内部使用，以捕获跨模拟服务器的所有交互，从而呈现测试结果。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestObserve</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">observeCalled</span><span class="w"> </span><span class="kt">bool</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Observe</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">apiTest</span><span class="w"> </span><span class="o">*</span><span class="nx">apitest</span><span class="p">.</span><span class="nx">APITest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">observeCalled</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">StatusCode</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;unexpected status code&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">observeCalled</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;Observe not called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="24-networking">2.4. Networking</h4>
<p>如果要针对正在运行的应用程序发起 HTTP 请求，则需要网络。并传递带有 cookie 的 http 请求，类似浏览器的会话行为，其中 cookie 要在多个 apitest 请求中留从。此方法可用于执行端到端的测试。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http/cookiejar&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="c1">// TestEnableNetworking creates a server with two endpoints, /login sets a token via a cookie and /authenticated_resource</span>
<span class="c1">// validates the token. A cookie jar is used to verify session persistence across multiple apitest instances</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">TestEnableNetworking</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">srv</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Server</span><span class="p">{</span><span class="nx">Addr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost:9876&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">finish</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kd">struct</span><span class="p">{})</span>
<span class="w">    </span><span class="nx">tokenValue</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;ABCDEF&quot;</span>

<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">SetCookie</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Token&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">tokenValue</span><span class="p">})</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="mi">203</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/authenticated_resource&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">(</span><span class="s">&quot;Token&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ErrNoCookie</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">token</span><span class="p">.</span><span class="nx">Value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">tokenValue</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;token did not equal %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tokenValue</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="mi">204</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">srv</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Recovered in f&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}()</span>

<span class="w">        </span><span class="nx">cookieJar</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cookiejar</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
<span class="w">        </span><span class="nx">cli</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Timeout</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Jar</span><span class="p">:</span><span class="w">     </span><span class="nx">cookieJar</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">            </span><span class="nx">EnableNetworking</span><span class="p">(</span><span class="nx">cli</span><span class="p">).</span>
<span class="w">            </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://localhost:9876/login&quot;</span><span class="p">).</span>
<span class="w">            </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">(</span><span class="mi">203</span><span class="p">).</span>
<span class="w">            </span><span class="nx">End</span><span class="p">()</span>

<span class="w">        </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">            </span><span class="nx">EnableNetworking</span><span class="p">(</span><span class="nx">cli</span><span class="p">).</span>
<span class="w">            </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://localhost:9876/authenticated_resource&quot;</span><span class="p">).</span>
<span class="w">            </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">(</span><span class="mi">204</span><span class="p">).</span>
<span class="w">            </span><span class="nx">End</span><span class="p">()</span>

<span class="w">        </span><span class="nx">finish</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="o">&lt;-</span><span class="nx">finish</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="3">3. 请求</h3>
<p>要配置对被测系统的初始请求，您可以指定请求参数，例如 http 方法、url、标头和 cookie。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Method</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodGet</span><span class="p">).</span>
<span class="w">    </span><span class="nx">URL</span><span class="p">(</span><span class="s">&quot;/user/12345&quot;</span><span class="p">)</span>
</code></pre></div>

<p>这非常冗长，因此为常见的 http 动作定义了一些快捷方式，这些动作对方法和 URL 进行了封闭。该示例可以更简洁地表示为：</p>
<div class="codehilite"><pre><span></span><code><span class="nx">apitest</span><span class="p">.</span><span class="nx">Handler</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/user/12345&quot;</span><span class="p">)</span>
</code></pre></div>

<p>你还可以用标准的 Go http.Request 来定义请求。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">req</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">httptest</span><span class="p">.</span><span class="nx">NewRequest</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodGet</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/user/1234&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="nx">apitest</span><span class="p">.</span><span class="nx">Handler</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Request</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
</code></pre></div>

<h4 id="31-basic-auth">3.1. Basic Auth</h4>
<p>提供了一个向请求添加基本身份验证的方法。</p>
<p><code>BasicAuth("username", "password")</code></p>
<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestRequests_BasicAuth</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">BasicAuth</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;username&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;password&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">BasicAuth</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;password&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="32-body">3.2. Body</h4>
<p>有两个方法去设置请求体--<code>Bady</code> 和 <code>JSON</code> 。使用 <code>Body</code> 将数据复制到原始请求中并包装在 <code>io.Reader</code>。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/message&quot;</span><span class="p">).</span><span class="nx">Body</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
</code></pre></div>

<p><code>JSON</code> 执行相同的操作并将提供的数据复制到正文，但 <code>JSON</code> 方法还将内容类型设置为 <code>application/json</code>。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/chat&quot;</span><span class="p">).</span><span class="nx">JSON</span><span class="p">(</span><span class="s">`{&quot;message&quot;: &quot;hi&quot;}`</span><span class="p">)</span>
</code></pre></div>

<p>如果要定义其他内容类型，请使用 <code>Body(data)</code> 设置包体，使用 <code>header</code> 设置标头。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/path&quot;</span><span class="p">).</span>
<span class="nx">Body</span><span class="p">(</span><span class="s">&quot;&lt;html&gt;content&lt;/html&gt;&quot;</span><span class="p">).</span>
<span class="nx">Header</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text/html&quot;</span><span class="p">)</span>
</code></pre></div>

<p>JSON 包体例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestRequests_JSONBody</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">`{&quot;a&quot;: 12345}`</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">JSON</span><span class="p">(</span><span class="s">`{&quot;a&quot;: 12345}`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p>文本包体例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestRequests_TextBody</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">`hello`</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Put</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Body</span><span class="p">(</span><span class="s">`hello`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="33-cookies">3.3. Cookies</h4>
<p>有多种方法可以指定 http 的请求 cookie。这些方法可以一起使用。</p>
<p><strong>简短形式</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">Cookie</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>结构</strong></p>
<p>Cookies 是一个被用于获取已定义的不同数量的 cookie 的结构体。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Cookies</span><span class="p">(</span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewCookie</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Path</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Domain</span><span class="p">(</span><span class="s">&quot;example.com&quot;</span><span class="p">))</span>
</code></pre></div>

<p>该结构的底层字段都是指针类型。这样，断言库就可以忽略结构体中未定义的字段。</p>
<h4 id="34-form">3.4. Form</h4>
<p>在请求中创建 URL 表单有多种方法。以下几种方法可以一起使用。</p>
<p><strong>多个值的Form</strong></p>
<p>FormData 是一个可变函数，可用于为同一键获取不同数量的值。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">FormData</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value2&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>简短的Form</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">FormData</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="35-graphql">3.5. GraphQL</h4>
<p>以下帮助程序可简化 GraphQL 请求的构建。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/graphql&quot;</span><span class="p">).</span>
<span class="nx">GraphQLQuery</span><span class="p">(</span><span class="s">`query { todos { text } }`</span><span class="p">).</span>

<span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/graphql&quot;</span><span class="p">).</span>
<span class="nx">GraphQLRequest</span><span class="p">(</span><span class="nx">apitest</span><span class="p">.</span><span class="nx">GraphQLRequestBody</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Query</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;query someTest($arg: String!) { test(who: $arg) }&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Variables</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">        </span><span class="s">&quot;arg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myArg&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">OperationName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myOperation&quot;</span><span class="p">,</span>
<span class="p">}).</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/stretchr/testify/assert&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestRequests_GraphQLQuery</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bodyBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">GraphQLRequestBody</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">bodyBytes</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">req</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">GraphQLRequestBody</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Query</span><span class="p">:</span><span class="w"> </span><span class="s">`query { todos { text } }`</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="nx">req</span><span class="p">)</span>

<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/query&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">GraphQLQuery</span><span class="p">(</span><span class="s">`query { todos { text } }`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestRequests_GraphQLRequest</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">bodyBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">GraphQLRequestBody</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">bodyBytes</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">req</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">expected</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">GraphQLRequestBody</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Query</span><span class="p">:</span><span class="w">         </span><span class="s">`query { todos { text } }`</span><span class="p">,</span>
<span class="w">                </span><span class="nx">OperationName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myOperation&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Variables</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="w">                    </span><span class="s">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">expected</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">)</span>

<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/query&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">GraphQLRequest</span><span class="p">(</span><span class="nx">apitest</span><span class="p">.</span><span class="nx">GraphQLRequestBody</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Query</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;query { todos { text } }&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Variables</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">OperationName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;myOperation&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p>上面的例子需要下载一些依赖项，如下：</p>
<div class="codehilite"><pre><span></span><code>go<span class="w"> </span>get<span class="w"> </span>github.com/stretchr/testify
go<span class="w"> </span>get<span class="w"> </span>github.com/davecgh/go-spew
go<span class="w"> </span>get<span class="w"> </span>github.com/pmezard/go-difflib
go<span class="w"> </span>get<span class="w"> </span>gopkg.in/yaml.v3
</code></pre></div>

<h4 id="36-headers">3.6. Headers</h4>
<p>有多种方法可以指定 http 请求头。以下方法可以一起使用。</p>
<p><strong>Map</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">Headers</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;name1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value2&quot;</span><span class="p">})</span>
</code></pre></div>

<p><strong>Params</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">Header</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="37-intercept">3.7. Intercept</h4>
<p><code>Intercept</code> 会在请求前调用，允许实现者在请求对象发送到被测系统前对其进行更改。在本例中，我们使用自定义方案设置请求参数。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestIntercept</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">RawQuery</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;a[]=xxx&amp;a[]=yyy&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;unexpected query&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Intercept</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">RawQuery</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;a[]=xxx&amp;a[]=yyy&quot;</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="38-query-params">3.8. Query Params</h4>
<p>有多种指定查询参数的方法。这些方法可以一起使用。</p>
<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestRequests_Query</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expectedQueryString</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;a=1&amp;a=2&amp;a=9&amp;a=22&amp;b=2&quot;</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">expectedQueryString</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">RawQuery</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/foo&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Query</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;9&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Query</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;22&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">QueryCollection</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">}}).</span>
<span class="w">        </span><span class="nx">QueryParams</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Collection</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">QueryCollection</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">}})</span>
</code></pre></div>

<p>参数的值设置为 <code>a=1&amp;a=2</code> 。</p>
<p><strong>Custom</strong></p>
<p>如果所提供的方法不合适，你可以定义自定义一个请求拦截器。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Intercept</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">RawQuery</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;a[]=xxx&amp;a[]=yyy&quot;</span>
<span class="w">    </span><span class="p">}).</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/path&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Map</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">QueryParams</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;param1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;param2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value2&quot;</span><span class="p">})</span>
</code></pre></div>

<p><strong>Params</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">Query</span><span class="p">(</span><span class="s">&quot;param&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="4">4. 异常</h3>
<p>我们提供了多种机制来验证响应。如果这些机制都不能满足您的需要，您可以提供自定义的 Assert 函数。定义请求后，必须调用 Expect(t) 去定义期望的结果。</p>
<h4 id="41-body">4.1. Body</h4>
<p>通过在 <code>Body</code> 方法中输入字符串去匹配 HTTP 响应体。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;param&quot;: &quot;value&quot;}`</span><span class="p">)</span>
</code></pre></div>

<p>断言库会检查内容是否为 JSON，如果是，则使用 testify 的 assert.JSONEq 方法执行断言。如果内容不是 JSON，则使用 testify 的 assert.Equal 方法。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">body</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAssertBody</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/greeting&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;message&quot;: &quot;hello&quot;}`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">handler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;message&quot;: &quot;hello&quot;}`</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="42-cookies">4.2. Cookies</h4>
<p>断言响应 cookie 的最简单方法是将 cookie 名称和值作为参数提供给 Cookie 方法。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Cookie</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">)</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAssertCookies</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">http</span><span class="p">.</span><span class="nx">SetCookie</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">})</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Cookie</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Cookie Not Present</strong></p>
<p>这是与 CookiePresent 相反的行为，用于判断断言响应中不存在具有给定名称的 cookie。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">CookieNotPresent</span><span class="p">(</span><span class="s">&quot;Session-Token&quot;</span><span class="p">)</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAssertCookies_NotPresent</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">http</span><span class="p">.</span><span class="nx">SetCookie</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">})</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">CookieNotPresent</span><span class="p">(</span><span class="s">&quot;token&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Cookie Present</strong></p>
<p>有时，应用程序会生成一个具有动态值的 cookie。如果不需要断言值，可使用 CookiePresent 方法，它只会断言 cookie 已被设置为给定的键。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">CookiePresent</span><span class="p">(</span><span class="s">&quot;Session-Token&quot;</span><span class="p">)</span>
</code></pre></div>

<p>apitest 会在内部保存 cookie，因此您可以多次调用此方法，对多个 cookie 进行断言。</p>
<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAssertCookies_Present</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">http</span><span class="p">.</span><span class="nx">SetCookie</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">})</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">CookiePresent</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Struct</strong></p>
<p>Cookies 是一个被用于获取已定义的不同数量的 cookie 的结构体。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Cookies</span><span class="p">(</span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewCookie</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Path</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Domain</span><span class="p">(</span><span class="s">&quot;example.com&quot;</span><span class="p">))</span>
</code></pre></div>

<p>该结构的底层字段都是指针类型。这样，断言库就可以忽略结构体中未定义的字段。</p>
<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAssertCookies_Struct</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">http</span><span class="p">.</span><span class="nx">SetCookie</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;name1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Secure</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">})</span>
<span class="w">            </span><span class="nx">http</span><span class="p">.</span><span class="nx">SetCookie</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;name2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Secure</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">})</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Cookies</span><span class="p">(</span>
<span class="w">            </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewCookie</span><span class="p">(</span><span class="s">&quot;name1&quot;</span><span class="p">).</span><span class="nx">Value</span><span class="p">(</span><span class="s">&quot;value1&quot;</span><span class="p">).</span><span class="nx">Secure</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">Path</span><span class="p">(</span><span class="s">&quot;/path1&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewCookie</span><span class="p">(</span><span class="s">&quot;name2&quot;</span><span class="p">).</span><span class="nx">Value</span><span class="p">(</span><span class="s">&quot;value2&quot;</span><span class="p">).</span><span class="nx">Secure</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="nx">Path</span><span class="p">(</span><span class="s">&quot;/path2&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="43">4.3. 自定义</h4>
<p>通过执行签名 <code>fn func(*http.Response, *http.Request) error</code>，提供自定义断言函数。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">StatusCode</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">StatusCode</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">400</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;unexpected status code&quot;</span><span class="p">)</span>
<span class="p">}).</span>
</code></pre></div>

<p>自定义断言函数可以是链式的。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">body</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;errors&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAssert_Custom</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">isSuccess</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">isSuccess</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">StatusCode</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">StatusCode</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">400</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;unexpected status code&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="44-headers">4.4. Headers</h4>
<p>有两种方法可以指定 HTTP 响应头。以下方法可以连锁使用。</p>
<p><strong>Map</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">Headers</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;name1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value2&quot;</span><span class="p">})</span>
</code></pre></div>

<p>头信息在 apitest 内部以规范形式存储。例如，"accept-encoding "的规范键是 "Accept-Encoding"。如果内容是 JSON，则使用 testify 的 assert.JSONEq 方法执行断言。如果内容不是 JSON，则使用 testify 的 assert.Equal 方法。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">body</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAssertHeaders_Map</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;name1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;name2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value2&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Headers</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;name1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;value2&quot;</span><span class="p">}).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Params</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">Header</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">)</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">body</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAssertHeaders_Params</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Header</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="45-json-path">4.5. JSON Path</h4>
<p>您可以使用 JSONPath 来断言响应中的部分内容。当你只对响应中的特定字段感兴趣时，这就很有用了。首先要安装一个单独的模块来提供这些断言，如下：</p>
<p><code>get -u github.com/steinfletcher/apitest-jsonpath</code></p>
<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewServeMux</span><span class="p">()</span>
<span class="w">    </span><span class="nx">handler</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{</span>
<span class="s">          &quot;aValue&quot;: &quot;0&quot;,</span>
<span class="s">          &quot;anObject&quot;: {&quot;a&quot;: &quot;1&quot;, &quot;b&quot;:  12345},</span>
<span class="s">          &quot;matches&quot;: {</span>
<span class="s">            &quot;anObject&quot;: {</span>
<span class="s">              &quot;aString&quot;: &quot;tom&lt;3Beer&quot;,</span>
<span class="s">              &quot;aNumber&quot;: 7.212,</span>
<span class="s">              &quot;aBool&quot;: true</span>
<span class="s">            },</span>
<span class="s">            &quot;aString&quot;: &quot;tom&lt;3Beer&quot;,</span>
<span class="s">            &quot;aNumber&quot;: 7,</span>
<span class="s">            &quot;aNumberSlice&quot;: [7, 8, 9],</span>
<span class="s">            &quot;aStringSlice&quot;: [&quot;7&quot;, &quot;8&quot;, &quot;9&quot;],</span>
<span class="s">            &quot;anObjectSlice&quot;: [{&quot;key&quot;:  &quot;c&quot;, &quot;value&quot;: &quot;ABC&quot;}]</span>
<span class="s">          }</span>
<span class="s">        }`</span><span class="p">))</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;aValue&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">NotEqual</span><span class="p">(</span><span class="s">&quot;aValue&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Present</span><span class="p">(</span><span class="s">&quot;aValue&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">NotPresent</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">`$.anObject`</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="mi">12345</span><span class="p">)})).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="s">`$.matches.anObjectSlice[? @.key==&quot;c&quot;].value`</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ABC&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span>
<span class="w">            </span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Root</span><span class="p">(</span><span class="s">&quot;matches&quot;</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`aString`</span><span class="p">,</span><span class="w"> </span><span class="s">`^[mot]{3}&lt;3[AB][re]{3}$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`aNumber`</span><span class="p">,</span><span class="w"> </span><span class="s">`^\d$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`anObject.aNumber`</span><span class="p">,</span><span class="w"> </span><span class="s">`^\d\.\d{3}$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`aNumberSlice[1]`</span><span class="p">,</span><span class="w"> </span><span class="s">`^[80]$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`anObject.aBool`</span><span class="p">,</span><span class="w"> </span><span class="s">`^true$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">End</span><span class="p">(),</span>
<span class="w">        </span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span>
<span class="w">            </span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Chain</span><span class="p">().</span>
<span class="w">                </span><span class="nx">NotPresent</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">).</span>
<span class="w">                </span><span class="nx">NotEqual</span><span class="p">(</span><span class="s">&quot;aValue&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;12&quot;</span><span class="p">).</span>
<span class="w">                </span><span class="nx">End</span><span class="p">(),</span>
<span class="w">        </span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p>上面的项目需要用到如下依赖，如下：</p>
<div class="codehilite"><pre><span></span><code>go<span class="w"> </span>get<span class="w"> </span>github.com/steinfletcher/apitest-jsonpath
go<span class="w"> </span>get<span class="w"> </span>github.com/PaesslerAG/jsonpath
go<span class="w"> </span>get<span class="w"> </span>github.com/PaesslerAG/gval
go<span class="w"> </span>get<span class="w"> </span>github.com/shopspring/decimal
</code></pre></div>

<p><strong>Chain</strong></p>
<p>同时提供多种解决方案</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span>
<span class="w">    </span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Chain</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">NotEqual</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Present</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">(),</span>
<span class="p">).</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_Chain</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;a&quot;: &quot;1&quot;, &quot;b&quot;: &quot;3&quot;, &quot;c&quot;: &quot;4&quot;}`</span><span class="p">))</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Chain</span><span class="p">().</span>
<span class="w">            </span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">).</span>
<span class="w">            </span><span class="nx">NotEqual</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">).</span>
<span class="w">            </span><span class="nx">Present</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">).</span>
<span class="w">            </span><span class="nx">End</span><span class="p">()).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Contains</strong></p>
<p>当选择器返回使用 <code>Contains</code> 的数组类型时，假设响应中的 JSON 主体为 {"id"： 12345, "items"： [{"available": true, "color": "red"}, {"available": false, "color": "blue"}]}, 我们可以选择所有在结果中可用于断言的颜色值。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="s">&quot;$.items[?@.available==true].color&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">))</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_Contains</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{</span>
<span class="s">              &quot;items&quot;: [</span>
<span class="s">                {</span>
<span class="s">                  &quot;available&quot;: true,</span>
<span class="s">                  &quot;color&quot;: &quot;red&quot;</span>
<span class="s">                },</span>
<span class="s">                {</span>
<span class="s">                  &quot;available&quot;: false,</span>
<span class="s">                  &quot;color&quot;: &quot;blue&quot;</span>
<span class="s">                }</span>
<span class="s">              ]</span>
<span class="s">            }`</span><span class="p">))</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="s">&quot;$.items[?@.available==true].color&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Equal</strong></p>
<p>当选择器返回单个值时，使用 Equal。假设响应中的 JSON 主体为 {"id"： "12345"}</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;$.id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;12345&quot;</span><span class="p">))</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_Equal</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;message&quot;: &quot;hello&quot;}`</span><span class="p">))</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Greater Than</strong></p>
<p>使用 "大于 "对返回值执行最小长度限制。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">GreaterThan</span><span class="p">(</span><span class="s">&quot;$.items&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_GreaterThan_LessThan</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;items&quot;: [3, 4]}`</span><span class="p">))</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">GreaterThan</span><span class="p">(</span><span class="s">&quot;items&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">LessThan</span><span class="p">(</span><span class="s">&quot;items&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>JWT Matchers</strong></p>
<p><code>JWTHeaderEqual</code> 和 <code>JWTPayloadEqual</code> 可用于断言响应中的 JWT 内容（不会验证 JWT）。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">Test</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">myHandler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">JWTPayloadEqual</span><span class="p">(</span><span class="nx">fromAuthHeader</span><span class="p">,</span><span class="w"> </span><span class="s">`$.sub`</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1234567890&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">JWTHeaderEqual</span><span class="p">(</span><span class="nx">fromAuthHeader</span><span class="p">,</span><span class="w"> </span><span class="s">`$.alg`</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;HS256&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">fromAuthHeader</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">Test</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">myHandler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">JWTPayloadEqual</span><span class="p">(</span><span class="nx">fromAuthHeader</span><span class="p">,</span><span class="w"> </span><span class="s">`$.sub`</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1234567890&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">JWTHeaderEqual</span><span class="p">(</span><span class="nx">fromAuthHeader</span><span class="p">,</span><span class="w"> </span><span class="s">`$.alg`</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;HS256&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">fromAuthHeader</span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Len</strong></p>
<p>使用 <code>Len</code> 检查返回值的长度。如果响应是 {"items"： [1, 2, 3]}，我们可以这样断言项的长度</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Len</span><span class="p">(</span><span class="s">&quot;$.items&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_Len</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;items&quot;: [1, 2, 3]}`</span><span class="p">))</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Len</span><span class="p">(</span><span class="s">`$.items`</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Less Than</strong></p>
<p>使用 <code>LessThan</code> 对返回值执行最大长度限制。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">LessThan</span><span class="p">(</span><span class="s">&quot;$.items&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_GreaterThan_LessThan</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;items&quot;: [3, 4]}`</span><span class="p">))</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">GreaterThan</span><span class="p">(</span><span class="s">&quot;items&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">LessThan</span><span class="p">(</span><span class="s">&quot;items&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Matches</strong></p>
<p>使用 <code>Matches</code> 检查字符串、数字或布尔类型的单个路径元素是否与正则表达式匹配。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Matches</span><span class="p">(</span><span class="s">&quot;$.a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^[abc]{1,3}$&quot;</span><span class="p">))</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_Matches</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewServeMux</span><span class="p">()</span>
<span class="w">    </span><span class="nx">handler</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{</span>
<span class="s">          &quot;matches&quot;: {</span>
<span class="s">            &quot;anObject&quot;: {</span>
<span class="s">              &quot;aString&quot;: &quot;tom&lt;3Beer&quot;,</span>
<span class="s">              &quot;aNumber&quot;: 7.212,</span>
<span class="s">              &quot;aBool&quot;: true</span>
<span class="s">            },</span>
<span class="s">            &quot;aString&quot;: &quot;tom&lt;3Beer&quot;,</span>
<span class="s">            &quot;aNumber&quot;: 7,</span>
<span class="s">            &quot;aNumberSlice&quot;: [7, 8, 9],</span>
<span class="s">            &quot;aStringSlice&quot;: [&quot;7&quot;, &quot;8&quot;, &quot;9&quot;],</span>
<span class="s">            &quot;anObjectSlice&quot;: [{&quot;key&quot;:  &quot;c&quot;, &quot;value&quot;: &quot;ABC&quot;}]</span>
<span class="s">          }</span>
<span class="s">        }`</span><span class="p">))</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span>
<span class="w">            </span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Root</span><span class="p">(</span><span class="s">&quot;matches&quot;</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`aString`</span><span class="p">,</span><span class="w"> </span><span class="s">`^[mot]{3}&lt;3[AB][re]{3}$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`aNumber`</span><span class="p">,</span><span class="w"> </span><span class="s">`^\d$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`anObject.aNumber`</span><span class="p">,</span><span class="w"> </span><span class="s">`^\d\.\d{3}$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`aNumberSlice[1]`</span><span class="p">,</span><span class="w"> </span><span class="s">`^[80]$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Matches</span><span class="p">(</span><span class="s">`anObject.aBool`</span><span class="p">,</span><span class="w"> </span><span class="s">`^true$`</span><span class="p">).</span>
<span class="w">                </span><span class="nx">End</span><span class="p">(),</span>
<span class="w">        </span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Not Equal</strong></p>
<p><code>NotEqual</code> 检查 json 路径表达式值是否不等于给定值</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">NotEqual</span><span class="p">(</span><span class="s">&quot;$.id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;56789&quot;</span><span class="p">))</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_NotEqual</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;message&quot;: &quot;hello&quot;}`</span><span class="p">))</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/data&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">NotEqual</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello1&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Not Present</strong></p>
<p>使用 <code>NotPresent</code> 来检查响应中是否缺少某个字段，而不对其值进行评估。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">NotPresent</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">))</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_NotPresent</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jan&quot;}`</span><span class="p">))</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">NotPresent</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Present</strong></p>
<p>检查响应中是否存在字段，但不评估其值。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Present</span><span class="p">(</span><span class="s">&quot;token&quot;</span><span class="p">))</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestJSONPath_Present</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;token&quot;: &quot;f9a5eb123c01de&quot;}`</span><span class="p">))</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Present</span><span class="p">(</span><span class="s">&quot;token&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Root</strong></p>
<p><code>Root</code> 用于避免在body中出现重复路径。如下：</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;$.a.b.c.d&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">)).</span>
<span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;$.a.b.c.e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">)).</span>
<span class="nx">Assert</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;$.a.b.c.f&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">)).</span>
</code></pre></div>

<p>也可以这样定义 <code>Root</code> 路径</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Assert</span><span class="p">(</span>
<span class="w">    </span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Root</span><span class="p">(</span><span class="s">&quot;a.b.c&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;c&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">(),</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="46-status-code">4.6. Status code</h4>
<p>使用 <code>status</code> 方法匹配 http 状态代码。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">jsonpath</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestAssertions_StatusCode</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/ping&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="5-mocks">5. MOCKS</h3>
<p><strong>我们为什么要用 <code>mocks</code>？</strong></p>
<p>应用程序与外部应用程序接口集成的情况非常普遍。在开发阶段运行测试时，最好有一个较短的反馈回路，而且测试必须是可重复和可再现的。与真正的外部应用程序接口集成会增加一些未知因素，这些因素往往会因为无法控制的原因而导致测试失败。</p>
<p>模拟外部调用可提高开发生命周期测试阶段的稳定性，帮助您更有信心地快速发布功能。这并不能取代集成测试。要不要进行mocks没有硬性规定，因项目而异。</p>
<p><strong>Mocks如何工作</strong></p>
<p>apitest 中的 mock 在很大程度上受到了 gock 的启发。模拟包劫持了默认的 HTTP 传输，并实现了一个自定义的 RoundTrip 方法。如果发出的 HTTP 请求与定义的模拟集合相匹配，模拟中定义的结果将返回给调用者。</p>
<h4 id="51-mocks">5.1. 定义Mocks</h4>
<p>调用 <code>apitest.NewMock()</code> 工厂方法可定义 mock。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">mock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://external.com/user/12345&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jon&quot;}`</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p>在上例中，当 HTTP 客户向 http://example.com/user/12345 发送 GET 请求时，{"name"： "jon"} 会在响应体中以 HTTP 状态代码 200 返回。</p>
<p>然后就可以在 apitest 配置部分添加 mock，如下所示：</p>
<div class="codehilite"><pre><span></span><code><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Mocks</span><span class="p">(</span><span class="nx">mock</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">httpHandler</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">defining_mocks</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestMocks</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">getUserMock</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/user-api&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jon&quot;, &quot;id&quot;: &quot;1234&quot;}`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>

<span class="w">    </span><span class="nx">getPreferencesMock</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/preferences-api&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;is_contactable&quot;: false}`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Mocks</span><span class="p">(</span><span class="nx">getUserMock</span><span class="p">,</span><span class="w"> </span><span class="nx">getPreferencesMock</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">myHandler</span><span class="p">()).</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jon&quot;, &quot;is_contactable&quot;: false}`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">myHandler</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">ServeMux</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewServeMux</span><span class="p">()</span>
<span class="w">    </span><span class="nx">handler</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="nx">user</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">httpGet</span><span class="p">(</span><span class="s">&quot;/user-api&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">user</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">contactPreferences</span><span class="w"> </span><span class="nx">contactPreferences</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">httpGet</span><span class="p">(</span><span class="s">&quot;/preferences-api&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">contactPreferences</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">userResponse</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w">          </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">            </span><span class="nx">IsContactable</span><span class="p">:</span><span class="w"> </span><span class="nx">contactPreferences</span><span class="p">.</span><span class="nx">IsContactable</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">handler</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">ID</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;id&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">contactPreferences</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">IsContactable</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="s">`json:&quot;is_contactable&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">userResponse</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">          </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">IsContactable</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;is_contactable&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">httpGet</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">DefaultClient</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;http://localhost:8080%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">))</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="52-matchers">5.2. Matchers</h4>
<p>您可以为header、cookie、url 查询参数和body添加匹配器。</p>
<p><strong>Body</strong></p>
<p>Body 允许您为请求报文添加匹配器。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">getUserMock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;http://example.com/user/12345&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;username&quot;: &quot;John&quot;}`</span><span class="p">).</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p>如果要处理 URL 编码的表单正文，可以使用 <code>FormData</code> 来匹配键和值。正则表达式也可以作为值。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">FormData</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Simon&quot;</span><span class="p">).</span>
<span class="nx">FormData</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jo([a-z]+)n&quot;</span><span class="p">).</span>
</code></pre></div>

<p>您还可以要求表单体键存在（FormDataPresent）或不存在（FormDataNotPresent）。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">FormDataPresent</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span>
<span class="nx">FormDataNotPresent</span><span class="p">(</span><span class="s">&quot;pets&quot;</span><span class="p">).</span>
</code></pre></div>

<p>JSONPath 扩展提供了一个自定义匹配器，支持在请求正文中进行匹配。这对部分匹配正文非常有用。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/user-external&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">AddMatcher</span><span class="p">(</span><span class="nx">mocks</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;$.name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;jan&quot;</span><span class="p">)).</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
</code></pre></div>

<p>例子</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">matchers</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;bytes&quot;</span>
<span class="w">    </span><span class="nx">jsonpath</span><span class="w"> </span><span class="s">&quot;github.com/steinfletcher/apitest-jsonpath/mocks&quot;</span>
<span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/steinfletcher/apitest&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestMocks</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">createUserMock</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/user-external&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">AddMatcher</span><span class="p">(</span><span class="nx">jsonpath</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;$.name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;jan&quot;</span><span class="p">)).</span>
<span class="w">        </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>

<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Mocks</span><span class="p">(</span><span class="nx">createUserMock</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">myHandler</span><span class="p">()).</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">JSON</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;jan&quot;</span><span class="p">}).</span>
<span class="w">        </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">myHandler</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">ServeMux</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewServeMux</span><span class="p">()</span>
<span class="w">    </span><span class="nx">handler</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">reqBody</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">DefaultClient</span><span class="p">.</span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;http://localhost:8080/user-external&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">reqBody</span><span class="p">))</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">handler</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Cookies</strong></p>
<p><code>Cookie</code> 允许您为 cookie 名称和值添加匹配器。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">getUserMock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://example.com/user/12345&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Cookie</span><span class="p">(</span><span class="s">&quot;sessionid&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1321&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jon&quot;}`</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p>您还可以要求 cookie 名称存在（<code>CookiePresent</code>）或不存在（<code>CookieNotPresent</code>）。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">getUserMock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://example.com/user/12345&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">CookiePresent</span><span class="p">(</span><span class="s">&quot;trackingid&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">CookieNotPresent</span><span class="p">(</span><span class="s">&quot;analytics&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jon&quot;}`</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p><strong>Custom matchers</strong></p>
<p>您可以使用 <code>AddMatcher</code> 编写自己的自定义匹配器。匹配器函数定义为 <code>func(*http.Request, *MockRequest) error</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">getUserMock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;http://example.com/user/12345&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">AddMatcher</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">mockReq</span><span class="w"> </span><span class="o">*</span><span class="nx">MockRequest</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPost</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;invalid http method&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}).</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p><strong>Header</strong></p>
<p><code>Header</code> 允许为头信息键和值添加匹配器。正则表达式也可以作为值</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">getUserMock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://example.com/user/12345&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Header</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Header</span><span class="p">(</span><span class="s">&quot;token&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b([a-z]+)z&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Headers</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;John&quot;</span><span class="p">})</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jon&quot;}`</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p>您也可以要求头必须存在（<code>HeaderPresent</code>）或不存在（<code>HeaderNotPresent</code>）。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">getUserMock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://example.com/user/12345&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">HeaderPresent</span><span class="p">(</span><span class="s">&quot;authtoken&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">HeaderNotPresent</span><span class="p">(</span><span class="s">&quot;requestid&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jon&quot;}`</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p><strong>Query parameters</strong></p>
<p>通过 <code>Query</code>，您可以为 url 查询参数的键和值添加匹配器。正则表达式也可以作为值。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">getUserMock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://example.com/user/12345&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Query</span><span class="p">(</span><span class="s">&quot;page&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Query</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jo([a-z]+)n&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">QueryParams</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;orderBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ASC&quot;</span><span class="p">}).</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jon&quot;}`</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p>您还可以要求查询参数存在（<code>QueryPresent</code>）或不存在（<code>QueryNotPresent</code>）。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">getUserMock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://example.com/user/12345&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">QueryPresent</span><span class="p">(</span><span class="s">&quot;page&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">QueryNotPresent</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;name&quot;: &quot;jon&quot;}`</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<h4 id="53-standalone">5.3. Standalone</h4>
<p>通过使用 mock 生成器上的 <code>EndStandalone</code> 终止方法，可以在 API 测试之外使用 mock。这对于在 API 测试之外测试 http 客户端非常有用。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestMocks_Standalone</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cli</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{</span><span class="nx">Timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;http://localhost:8080/path&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;a&quot;, 12345}`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">).</span>
<span class="w">        </span><span class="nx">EndStandalone</span><span class="p">()()</span>

<span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cli</span><span class="p">.</span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;http://localhost:8080/path&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;application/json&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">strings</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="s">`{&quot;a&quot;, 12345}`</span><span class="p">))</span>

<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p><code>EndStandalone</code> 会返回一个函数，在测试运行后调用该函数可将 http 传输重置为默认配置。</p>
<p>如果想在一个测试中注册多个独立模拟，请使用 <code>apitest.NewStandaloneMocks()</code> 工厂方法。</p>
<div class="codehilite"><pre><span></span><code><span class="nx">resetTransport</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewStandaloneMocks</span><span class="p">(</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;http://localhost:8080/path&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;a&quot;: 12345}`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewMock</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://localhost:8080/path&quot;</span><span class="p">).</span>
<span class="w">        </span><span class="nx">RespondWith</span><span class="p">().</span>
<span class="w">        </span><span class="nx">Body</span><span class="p">(</span><span class="s">`{&quot;a&quot;: 12345}`</span><span class="p">).</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">        </span><span class="nx">End</span><span class="p">(),</span>
<span class="p">).</span><span class="nx">End</span><span class="p">()</span>
<span class="k">defer</span><span class="w"> </span><span class="nx">resetTransport</span><span class="p">()</span>
</code></pre></div>

<h3 id="6-integrations">6. INTEGRATIONS</h3>
<p><code>apitest</code> 有许多注入点，因此很容易与其他第三方工具和测试库集成。</p>
<h4 id="61-ginkgo">6.1. Ginkgo</h4>
<p><code>apitest</code> 通过接口接受 <code>*testing.T</code>。这样就可以与其他测试库（如 Ginkgo）集成。您可以通过 <a href="https://onsi.github.io/ginkgo/#using-other-matcher-libraries">GinkgoT()</a> 生成一个模仿 <code>*testing.T</code> 的对象，并直接与 Ginkgo 通信。请参阅完整示例 <a href="https://github.com/steinfletcher/apitest/tree/master/examples/ginkgo">此处</a>。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Describe</span><span class="p">(</span><span class="s">&quot;Ginkgo/Server&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="nx">t</span><span class="w">      </span><span class="nx">GinkgoTInterface</span>
<span class="w">        </span><span class="nx">router</span><span class="w"> </span><span class="o">*</span><span class="nx">mux</span><span class="p">.</span><span class="nx">Router</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="nx">BeforeEach</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">GinkgoT</span><span class="p">()</span>
<span class="w">        </span><span class="nx">router</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">NewApp</span><span class="p">().</span><span class="nx">Router</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="nx">Context</span><span class="p">(</span><span class="s">&quot;Successful CookieMatching&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">It</span><span class="p">(</span><span class="s">&quot;cookies should be set correctly&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">                </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">router</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/user/1234&quot;</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">                </span><span class="nx">Cookies</span><span class="p">(</span><span class="nx">apitest</span><span class="p">.</span><span class="nx">NewCookie</span><span class="p">(</span><span class="s">&quot;TomsFavouriteDrink&quot;</span><span class="p">).</span>
<span class="w">                    </span><span class="nx">Value</span><span class="p">(</span><span class="s">&quot;Beer&quot;</span><span class="p">).</span>
<span class="w">                    </span><span class="nx">Path</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)).</span>
<span class="w">                </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">                </span><span class="nx">End</span><span class="p">()</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">})</span>
</code></pre></div>

<h3 id="7-reports">7. REPORTS</h3>
<p>apitest 包含一种报告机制，可以生成序列图，说明入站请求、最终响应、与模拟的任何交互，甚至数据库查询。您甚至可以实现自己的 "ReportFormatter "来消费报告数据，从而生成自己的报告。</p>
<p>报告支持的主要组成部分是：</p>
<ol>
<li><strong>Event</strong> 有两种类型的事件：HTTP 事件和自定义事件。HTTP 事件代表模拟交互、进入应用程序的请求和最终响应。自定义事件用于从任意来源生成数据。自定义事件包含标题和正文。我们在 apitest 中使用这种事件类型来记录数据库交互。</li>
<li><strong>Recorder</strong> 记录测试执行期间发生的事件，如模拟交互、数据库交互以及与被测应用程序的 HTTP 交互。如果输入自己的记录器，就可以添加自定义事件，然后通过实现 ReportFormatter 来处理这些事件。这对于记录从亚马逊 S3 客户端等来源生成的自定义事件可能很有用。</li>
<li><strong>ReportFormatter</strong> 用户可用于生成自定义报告的接口。接收报告记录器，该记录器会暴露事件。SequenceDiagramFormatter 是 apitest 中包含的此接口的实现，可根据事件数据渲染 HTML 序列图。</li>
</ol>
<h4 id="71-sequence-diagrams">7.1. Sequence diagrams</h4>
<p>配置报告程序以创建序列图，如下所示</p>
<div class="codehilite"><pre><span></span><code><span class="nx">apitest</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span>
<span class="w">    </span><span class="nx">Report</span><span class="p">(</span><span class="nx">apitest</span><span class="p">.</span><span class="nx">SequenceDiagram</span><span class="p">()).</span>
<span class="w">    </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">handler</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Expect</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span>
<span class="w">    </span><span class="nx">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">).</span>
<span class="w">    </span><span class="nx">End</span><span class="p">()</span>
</code></pre></div>

<p>在这个 <a href="https://github.com/steinfletcher/apitest/tree/master/examples/sequence-diagrams">示例</a> 中，我们实现了一个 REST API，并生成了一个与 http 交互的序列图。</p>
<p>生成的下图说明了测试中协作者之间的交互。<code>sut</code> 块是被测系统。</p>
<p><img alt="sequence diagram report" src="https://apitest.dev/static/images/seq-diagram.png" /></p>
<p>对于每次交互，请求/响应的 http 线表示法都会呈现在图表下方的事件日志中</p>
<p><img alt="sequence diagram report" src="https://apitest.dev/static/images/seq-diag-log.png" /></p>
<h3 id="8">8. 例子</h3>
<p><code>apitest</code> 实例：<code>https://github.com/steinfletcher/apitest/tree/master/examples</code></p>
        <div class="copyright">
          <ul>
            <li>本文作者：畄月寒</li>
            <li>本文链接：<a href="https://testpoo.github.io/go测试库apitest简介.html">https://testpoo.github.io/go测试库apitest简介.html</a></li>
            <li>版权声明：本铺所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans"> BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
          </ul>
        </div>
      </div>
    </div>
    <input class="pswitch ponoff" type="checkbox" id="nvacatalog">
    <div class="nav">
      <ul>
        
        <li><a href="https://testpoo.github.io/关于我.html"><span><label style="color: #38b6fd"></label>&nbsp;关于我</span></a></li>
        
        <li><a href="https://testpoo.github.io/网址集.html"><span><label style="color: #38b6fd"></label>&nbsp;网址集</span></a></li>
        
        <li><a href="https://testpoo.github.io/问题集.html"><span><label style="color: #38b6fd"></label>&nbsp;问题集</span></a></li>
        
        <li><a href="https://testpoo.github.io/使用tar包安装mysql.html"><span><label style="color: #38b6fd"></label>&nbsp;使用tar包安装mysql</span></a></li>
        
        <li><a href="https://testpoo.github.io/安装docker-swarm.html"><span><label style="color: #38b6fd"></label>&nbsp;安装docker-swarm</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian+sway安装设置.html"><span><label style="color: #38b6fd"></label>&nbsp;debian+sway安装设置</span></a></li>
        
        <li><a href="https://testpoo.github.io/人生的最高境界.html"><span><label style="color: #38b6fd"></label>&nbsp;人生的最高境界</span></a></li>
        
        <li><a href="https://testpoo.github.io/中国朝代顺序口诀.html"><span><label style="color: #38b6fd"></label>&nbsp;中国朝代顺序口诀</span></a></li>
        
        <li><a href="https://testpoo.github.io/国际象棋棋子代号.html"><span><label style="color: #38b6fd"></label>&nbsp;国际象棋棋子代号</span></a></li>
        
        <li><a href="https://testpoo.github.io/CSS代码小抄.html"><span><label style="color: #38b6fd"></label>&nbsp;CSS代码小抄</span></a></li>
        
        <li><a href="https://testpoo.github.io/婚书两则.html"><span><label style="color: #38b6fd"></label>&nbsp;婚书两则</span></a></li>
        
        <li><a href="https://testpoo.github.io/只有一个读音的九篇古文.html"><span><label style="color: #38b6fd"></label>&nbsp;只有一个读音的九篇古文</span></a></li>
        
        <li><a href="https://testpoo.github.io/独孤羊放妻春条书.html"><span><label style="color: #38b6fd"></label>&nbsp;独孤羊放妻春条书</span></a></li>
        
        <li><a href="https://testpoo.github.io/javascript代码小抄.html"><span><label style="color: #38b6fd"></label>&nbsp;javascript代码小抄</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian安装设置.html"><span><label style="color: #38b6fd"></label>&nbsp;debian安装设置</span></a></li>
        
        <li><a href="https://testpoo.github.io/python代码小抄.html"><span><label style="color: #38b6fd"></label>&nbsp;python代码小抄</span></a></li>
        
        <li><a href="https://testpoo.github.io/Arch通过archinstall安装过程.html"><span><label style="color: #38b6fd"></label>&nbsp;Arch通过archinstall安装过程</span></a></li>
        
        <li><a href="https://testpoo.github.io/Jinja2简介.html"><span><label style="color: #38b6fd"></label>&nbsp;Jinja2简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/shell三剑客简介.html"><span><label style="color: #38b6fd"></label>&nbsp;shell三剑客简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/Python造假数据神器Faker.html"><span><label style="color: #38b6fd"></label>&nbsp;Python造假数据神器Faker</span></a></li>
        
        <li><a href="https://testpoo.github.io/FastApi简析.html"><span><label style="color: #38b6fd"></label>&nbsp;FastApi简析</span></a></li>
        
        <li><a href="https://testpoo.github.io/go测试库apitest简介.html"><span><label style="color: #38b6fd"></label>&nbsp;go测试库apitest简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/go入门.html"><span><label style="color: #38b6fd"></label>&nbsp;go入门</span></a></li>
        
        <li><a href="https://testpoo.github.io/Arch手动安装过程.html"><span><label style="color: #38b6fd"></label>&nbsp;Arch手动安装过程</span></a></li>
        
        <li><a href="https://testpoo.github.io/BeautifulSoup简介.html"><span><label style="color: #38b6fd"></label>&nbsp;BeautifulSoup简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/tkinter教程.html"><span><label style="color: #38b6fd"></label>&nbsp;tkinter教程</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian+openbox安装过程.html"><span><label style="color: #38b6fd"></label>&nbsp;debian+openbox安装过程</span></a></li>
        
        <li><a href="https://testpoo.github.io/面试问答.html"><span><label style="color: #38b6fd"></label>&nbsp;面试问答</span></a></li>
        
        <li><a href="https://testpoo.github.io/UI自动化测试神器-Cypress.html"><span><label style="color: #38b6fd"></label>&nbsp;UI自动化测试神器-Cypress</span></a></li>
        
        <li><a href="https://testpoo.github.io/如何用自动化测试搞垮团队.html"><span><label style="color: #38b6fd"></label>&nbsp;如何用自动化测试搞垮团队</span></a></li>
        
        <li><a href="https://testpoo.github.io/shell简介.html"><span><label style="color: #38b6fd"></label>&nbsp;shell简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/mysql函数汇总.html"><span><label style="color: #38b6fd"></label>&nbsp;mysql函数汇总</span></a></li>
        
        <li><a href="https://testpoo.github.io/Docker入门教程.html"><span><label style="color: #38b6fd"></label>&nbsp;Docker入门教程</span></a></li>
        
        <li><a href="https://testpoo.github.io/性能监控各指令详解.html"><span><label style="color: #38b6fd"></label>&nbsp;性能监控各指令详解</span></a></li>
        
        <li><a href="https://testpoo.github.io/Python进阶.html"><span><label style="color: #38b6fd"></label>&nbsp;Python进阶</span></a></li>
        
        <li><a href="https://testpoo.github.io/Git简介.html"><span><label style="color: #38b6fd"></label>&nbsp;Git简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/Python正则表达式.html"><span><label style="color: #38b6fd"></label>&nbsp;Python正则表达式</span></a></li>
        
        <li><a href="https://testpoo.github.io/nose简介.html"><span><label style="color: #38b6fd"></label>&nbsp;nose简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/Python自动化之unittest.html"><span><label style="color: #38b6fd"></label>&nbsp;Python自动化之unittest</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian+i3安装过程.html"><span><label style="color: #38b6fd"></label>&nbsp;debian+i3安装过程</span></a></li>
        
        <li><a href="https://testpoo.github.io/mysql的安装.html"><span><label style="color: #38b6fd"></label>&nbsp;mysql的安装</span></a></li>
        
        <li><a href="https://testpoo.github.io/紫薇斗数解析.html"><span><label style="color: #38b6fd"></label>&nbsp;紫薇斗数解析</span></a></li>
        
        <li><a href="https://testpoo.github.io/分分种学会python3.html"><span><label style="color: #38b6fd"></label>&nbsp;分分种学会python3</span></a></li>
        
        <li><a href="https://testpoo.github.io/Markdown笔记.html"><span><label style="color: #38b6fd"></label>&nbsp;Markdown笔记</span></a></li>
        
        <li><a href="https://testpoo.github.io/Linux下SVN服务器的搭建.html"><span><label style="color: #38b6fd"></label>&nbsp;Linux下SVN服务器的搭建</span></a></li>
        
        <li><a href="https://testpoo.github.io/mysql笔记.html"><span><label style="color: #38b6fd"></label>&nbsp;mysql笔记</span></a></li>
        
        <li><a href="https://testpoo.github.io/python标准异常.html"><span><label style="color: #38b6fd"></label>&nbsp;python标准异常</span></a></li>
        
        <li><a href="https://testpoo.github.io/svn命令全解.html"><span><label style="color: #38b6fd"></label>&nbsp;svn命令全解</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian命令apt和dpkg用法.html"><span><label style="color: #38b6fd"></label>&nbsp;debian命令apt和dpkg用法</span></a></li>
        
      </ul>
    </div>
  </body>

  </html>