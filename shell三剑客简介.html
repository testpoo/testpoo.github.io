<!doctype html>
  <html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>测试铺</title>
    <link rel="stylesheet" type="text/css" href="https://testpoo.github.io/themes/css/markdown.css">
    <link rel="stylesheet" type="text/css" href="https://testpoo.github.io/themes/css/style.css">
    <link rel="shortcut icon" type="image/ico" href="https://testpoo.github.io/themes/img/favicon.ico">
  </head>

  

  <body>
    <div class="sider">
      <div class="categories">
        <div class="title">
          <a href="https://testpoo.github.io">
            <img src="https://testpoo.github.io/themes/img/title.jpg">
            <div class="linkbutton testpoo">测试铺</div>
          </a>
        </div>
        <div class="scrollheight">
          <ul>
            
            <li><a href="https://testpoo.github.io/关于我.html"><label style="color: #38b6fd"></label>&nbsp;关于我</a></li>
            
            <li><a href="https://testpoo.github.io/网址集.html"><label style="color: #38b6fd"></label>&nbsp;网址集</a></li>
            
            <li><a href="https://testpoo.github.io/问题集.html"><label style="color: #38b6fd"></label>&nbsp;问题集</a></li>
            
            <li><a href="https://testpoo.github.io/安装dockerswarm.html"><label style="color: #38b6fd"></label>&nbsp;技术</a></li>
            
            <li><a href="https://testpoo.github.io/debian+sway安装设置.html"><label style="color: #38b6fd"></label>&nbsp;系统安装</a></li>
            
            <li><a href="https://testpoo.github.io/人生的最高境界.html"><label style="color: #38b6fd"></label>&nbsp;摘录</a></li>
            
            <li><a href="https://testpoo.github.io/CSS代码小抄.html"><label style="color: #38b6fd"></label>&nbsp;代码小抄</a></li>
            
            <li><a href="https://testpoo.github.io/Python造假数据神器Faker.html"><label style="color: #38b6fd"></label>&nbsp;测试</a></li>
            
          </ul>
        </div>
        <div class="github"><a href="https://github.com/testpoo" target="_blank" title="GitHub:https://github.com/testpoo"></a><a href="#" title="微信号：puyaweis"></a><a href="#" title="邮箱：pu_yawei@qq.com"></a><a href="https://testpoo.github.io/rss.xml" target="_blank"></a></div>
      </div>
      <div class="articles">
        <div class="category"> 技术</div>
        <div class="scrollheight">
          <ul>
            
            <a href="https://testpoo.github.io/安装dockerswarm.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;安装dockerswarm</span><span>2025-03-12&nbsp;&nbsp;共6230个字</span><span class="tag">dockerswarm</span></li></a>
            
            <a href="https://testpoo.github.io/Jinja2简介.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;Jinja2简介</span><span>2024-02-29&nbsp;&nbsp;共8808个字</span><span class="tag">jinja2</span><span class="tag">python</span></li></a>
            
            <a href="https://testpoo.github.io/shell三剑客简介.html#current"><li style="background: #f9fafb;border: 0px;" id="current"><span><label style="color: #38b6fd"></label>&nbsp;shell三剑客简介</span><span>2024-02-29&nbsp;&nbsp;共18477个字</span><span class="tag">linux</span><span class="tag">awk</span><span class="tag">grep</span><span class="tag">sed</span></li></a>
            
            <a href="https://testpoo.github.io/FastApi简析.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;FastApi简析</span><span>2023-12-06&nbsp;&nbsp;共17242个字</span><span class="tag">fastapi</span><span class="tag">python</span></li></a>
            
            <a href="https://testpoo.github.io/go入门.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;go入门</span><span>2023-08-15&nbsp;&nbsp;共23389个字</span><span class="tag">go</span></li></a>
            
            <a href="https://testpoo.github.io/tkinter教程.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;tkinter教程</span><span>2022-11-14&nbsp;&nbsp;共93974个字</span><span class="tag">python</span><span class="tag">tkinter</span></li></a>
            
            <a href="https://testpoo.github.io/mysql函数汇总.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;mysql函数汇总</span><span>2022-04-18&nbsp;&nbsp;共48992个字</span><span class="tag">mysql</span></li></a>
            
            <a href="https://testpoo.github.io/shell简介.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;shell简介</span><span>2022-04-18&nbsp;&nbsp;共14941个字</span><span class="tag">linux</span><span class="tag">shell</span></li></a>
            
            <a href="https://testpoo.github.io/Docker入门教程.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;Docker入门教程</span><span>2022-03-02&nbsp;&nbsp;共16064个字</span><span class="tag">docker</span></li></a>
            
            <a href="https://testpoo.github.io/Python进阶.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;Python进阶</span><span>2021-11-30&nbsp;&nbsp;共39681个字</span><span class="tag">python</span></li></a>
            
            <a href="https://testpoo.github.io/Git简介.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;Git简介</span><span>2021-09-15&nbsp;&nbsp;共29722个字</span><span class="tag">git</span></li></a>
            
            <a href="https://testpoo.github.io/Python正则表达式.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;Python正则表达式</span><span>2021-06-23&nbsp;&nbsp;共21614个字</span><span class="tag">python</span><span class="tag">正则表达式</span></li></a>
            
            <a href="https://testpoo.github.io/mysql的安装.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;mysql的安装</span><span>2020.05.09&nbsp;&nbsp;共8129个字</span><span class="tag">mysql</span><span class="tag">安装</span></li></a>
            
            <a href="https://testpoo.github.io/分分种学会python3.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;分分种学会python3</span><span>2020-05-14&nbsp;&nbsp;共10704个字</span><span class="tag">python</span></li></a>
            
            <a href="https://testpoo.github.io/Markdown笔记.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;Markdown笔记</span><span>2020-04-03&nbsp;&nbsp;共9889个字</span><span class="tag">markdown</span></li></a>
            
            <a href="https://testpoo.github.io/Linux下SVN服务器的搭建.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;Linux下SVN服务器的搭建</span><span>2020-01-01&nbsp;&nbsp;共13069个字</span><span class="tag">svn</span><span class="tag">linux</span></li></a>
            
            <a href="https://testpoo.github.io/mysql笔记.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;mysql笔记</span><span>2019-10-11&nbsp;&nbsp;共4893个字</span><span class="tag">mysql</span></li></a>
            
            <a href="https://testpoo.github.io/python标准异常.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;python标准异常</span><span>2019-10-11&nbsp;&nbsp;共2649个字</span><span class="tag">python</span><span class="tag">标准异常</span></li></a>
            
            <a href="https://testpoo.github.io/svn命令全解.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;svn命令全解</span><span>2019-10-11&nbsp;&nbsp;共3837个字</span><span class="tag">svn</span></li></a>
            
            <a href="https://testpoo.github.io/debian命令apt和dpkg用法.html#current"><li ><span><label style="color: #38b6fd"></label>&nbsp;debian命令apt和dpkg用法</span><span>2019-07-05&nbsp;&nbsp;共6342个字</span><span class="tag">debian</span><span class="tag">apt</span><span class="tag">dpkg</span></li></a>
            
          </ul>
        </div>
        <div class="item-num">总共20项</div>
      </div>
    </div>
    <div class="main">
      <div class="header"><span>shell三剑客简介</span><span>人生如逆旅，我亦是行人。<br />最后更新于2025-03-12 17:54:26</span></div>
      <input class="pswitch ponoff" type="checkbox" id="catalog">
      <div class="posts">
        <div class="toc">
<ul>
<li><a href="#1-shell">1. shell三剑客简介</a></li>
<li><a href="#2-grep">2. 三剑客之grep</a><ul>
<li><a href="#21">2.1. 常用参数</a></li>
<li><a href="#22">2.2. 示例</a></li>
</ul>
</li>
<li><a href="#3-sed">3. 三剑客之sed</a><ul>
<li><a href="#31">3.1 常用参数</a></li>
<li><a href="#32">3.2. 示例</a></li>
</ul>
</li>
<li><a href="#4-awk">4. 三剑客之awk</a><ul>
<li><a href="#41">4.1. 常用参数</a></li>
<li><a href="#42">4.2. 示例</a></li>
<li><a href="#43-beginend">4.3. BEGIN和END</a></li>
<li><a href="#44">4.4. 内置变量</a></li>
<li><a href="#45">4.5. 运算符</a></li>
</ul>
</li>
</ul>
</div>
<h3 id="1-shell">1. shell三剑客简介</h3>
<p>awk、grep、sed是linux操作文本的三大利器，合称文本三剑客，也是必须掌握的linux命令之一。三者的功能都是处理文本，但侧重点各不相同，其中属awk功能最强大，但也最复杂。grep更适合单纯的查找或匹配文本，sed更适合编辑匹配到的文本，awk更适合格式化文本，对文本进行较复杂格式处理。</p>
<p><strong>三剑客的特点:</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>命令</strong></th>
<th style="text-align: left;"><strong>特点</strong></th>
<th style="text-align: left;"><strong>使用场景</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">grep</td>
<td style="text-align: left;">擅长查找过滤</td>
<td style="text-align: left;">快速查找过滤</td>
</tr>
<tr>
<td style="text-align: left;">sed</td>
<td style="text-align: left;">擅长取行和替换</td>
<td style="text-align: left;">需要快速进行替换/修改文件内容</td>
</tr>
<tr>
<td style="text-align: left;">awk</td>
<td style="text-align: left;">擅长取列、统计计算</td>
<td style="text-align: left;">文件取列、数据切片、对比/比较和统计</td>
</tr>
</tbody>
</table>
<h3 id="2-grep">2. 三剑客之grep</h3>
<p>grep 命令是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。grep全称是 Global Regular Expression Print，表示全局正则表达式版本，它的使用权限是所有用户。</p>
<p>grep是文本查找或搜索工具，用于查找内容包含指定的范本样式的文本。它会一行一行循环匹配，匹配到相应的值时会先输出，然后换行继续匹配再换行直到所有的内容都匹配完。</p>
<p>命令格式：<code>grep [option] pattern file</code></p>
<p>大家熟悉的命令：<code>ps -ef|grep xxxx</code></p>
<h4 id="21">2.1. 常用参数</h4>
<ul>
<li>
<p>-n：显示行号；</p>
</li>
<li>
<p>-i：忽略大小写；</p>
</li>
<li>
<p>-o：精准匹配；</p>
</li>
<li>
<p>-f：从文件每一行获取匹配模式；</p>
</li>
<li>
<p>-c：统计匹配的行数；</p>
</li>
<li>
<p>-E：使用扩展正则表达式，相当于egrep；</p>
</li>
<li>
<p>-v：反转查找，即输出与查找条件不相符合的行；</p>
</li>
<li>
<p>-A：后面可加数字，为 after 的意思，除了列出该行外，后续的 n 行也列出来；</p>
</li>
<li>
<p>-B：后面可加数字，为 before 的意思，除了列出该行外，前面的 n 行也列出来；</p>
</li>
<li>
<p>-C：后面可加数字，为context 的意思，除了列出该行外，前后的n行也列出来。</p>
</li>
</ul>
<h4 id="22">2.2. 示例</h4>
<p><strong>1.</strong> 查找多个文件中相同的内容</p>
<pre class="codehilite"><code class="language-Shell">$ grep &quot;我们&quot; one two

one:我们下午没有课
two:我们是祖国的花朵
</code></pre>

<p><strong>2.</strong> 输出two文件和one文件中相同的行</p>
<pre class="codehilite"><code>$ grep -n -f one two

3:心情挺好的
</code></pre>

<p><strong>3.</strong> 输出在two文件中不在one文件中的行</p>
<pre class="codehilite"><code>$ grep -v -f one two

我们是祖国的花朵
每天好开心啊
</code></pre>

<p><strong>4.</strong> 输出正则匹配到的内容</p>
<pre class="codehilite"><code>$ echo &quot;this is a test shell!&quot; |grep -oE &quot;[a-z]+&quot;

this
is
a
test
shell
</code></pre>

<p><strong>5.</strong> 只显示匹配的字符串</p>
<pre class="codehilite"><code>$ echo &quot;this is a test&quot; |grep -o &quot;is&quot;

is
is
</code></pre>

<p><strong>6.</strong> 匹配显示所有IP</p>
<pre class="codehilite"><code>$ ip a |grep -oE -0 &quot;[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}&quot;
127.0.0.1
--
192.168.214.2
192.168.214.255
</code></pre>

<h3 id="3-sed">3. 三剑客之sed</h3>
<p><code>sed</code> 是一种流编辑器，是非常好用的文本处理工具，配合正则使用更加强大。处理时，把当前处理的行存储在临时的缓冲区中，称为“模式空间”，接着 <code>sed</code> 命令处理缓冲区的内容，完成后输出到屏幕，接着处理下一行。文件内容没有改变，除非使用 <code>-i</code> 选项。</p>
<p><code>sed</code> 主要用来编辑一个或多个文件，简化对文件的反复操作或者用来编写转换程序等。还有一个空间叫保持空间，又称暂存空间，可以暂时存放一些处理的数据，但不能直接输出，只能放到模式空间输出。</p>
<p><strong>语法格式：</strong><code>sed [选项] [地址] [命令] file</code></p>
<h4 id="31">3.1 常用参数</h4>
<p><strong>1.</strong> 选项描述</p>
<ul>
<li>
<p>-n：不打印模式空间；</p>
</li>
<li>
<p>-e：执行脚本、表达式来处理；</p>
</li>
<li>
<p>-f：执行动作从文件读取执行；</p>
</li>
<li>
<p>-i：修改原文件；</p>
</li>
<li>
<p>-r：使用扩展正则表达式。</p>
</li>
</ul>
<p><strong>2.</strong> 地址描述</p>
<ul>
<li>
<p>first~step：步长，每step行，从第first开始；</p>
</li>
<li>
<p>$：匹配最后一行；</p>
</li>
<li>
<p>/regexp/：正则表达式匹配行；</p>
</li>
<li>
<p>number：只匹配指定行；</p>
</li>
<li>
<p>addr1,addr2：开始匹配addr1行开始，直接addr2行结束；</p>
</li>
<li>
<p>addr1,+N：从addr1行开始，向后的N行；</p>
</li>
<li>
<p>addr1,~N：从addr1行开始，到N行结束。</p>
</li>
</ul>
<p><strong>3.</strong> 地址描述</p>
<ul>
<li>
<p>s/regexp/replacement/：替换字符串；</p>
</li>
<li>
<p>p：打印当前模式空间；</p>
</li>
<li>
<p>P：打印模式空间的第一行；</p>
</li>
<li>
<p>d：删除模式空间，开始下一个循环；</p>
</li>
<li>
<p>D：删除模式空间的第一行，开始下一个循环；</p>
</li>
<li>
<p>=：打印当前行号；</p>
</li>
<li>
<p>a：当前行下面追加文本；</p>
</li>
<li>
<p>i：当前行上面插入文本；</p>
</li>
<li>
<p>c：所选行替换新文本；</p>
</li>
<li>
<p>q：立即退出sed脚本；</p>
</li>
<li>
<p>r：追加文本来自文件；</p>
</li>
<li>
<p>: label：label为b和t命令；</p>
</li>
<li>
<p>b label：分支到脚本中带有标签的位置，如果分支不存在则分支到脚本的末尾；</p>
</li>
<li>
<p>t label：如果s///是一个成功的替换，才跳转到标签；</p>
</li>
<li>
<p>h H：复制/追加模式空间到保持空间；</p>
</li>
<li>
<p>g G：复制/追加保持空间到模式空间；</p>
</li>
<li>
<p>x：交换模式空间和保持空间内容；</p>
</li>
<li>
<p>y：把一个字符翻译为另外的字符；</p>
</li>
<li>
<p>l：打印模式空间的行，并显示控制字符\$；</p>
</li>
<li>
<p>n N：读取/追加下一行输入到模式空间；</p>
</li>
<li>
<p>w filename：写入当前模式空间到文件；</p>
</li>
<li>
<p>!：取反、否定；</p>
</li>
<li>
<p>&amp;：引用已匹配字符串。</p>
</li>
</ul>
<h4 id="32">3.2. 示例</h4>
<p><strong>1.</strong> 从第一个空格开始全局替换成 <code>-</code></p>
<pre class="codehilite"><code>$ echo &quot;hello world&quot; | sed 's/ /-/g'

hello-world
</code></pre>

<p><strong>2.</strong> 匹配替换字符串</p>
<pre class="codehilite"><code>$ echo &quot;hello world&quot; | sed 's/world/[&amp;]/'

hello [world]
</code></pre>

<p><strong>3.</strong> 打印指定行的内容</p>
<pre class="codehilite"><code>$ cat -n one
     1  今天天气不错
     2  挺风和日丽的
     3  我们下午没有课
     4  心情挺好的

$ sed -n '2,4p' one

挺风和日丽的
我们下午没有课
心情挺好的
</code></pre>

<p><strong>4.</strong> 读取一个文件的内容到另一个文件的匹配位置显示</p>
<pre class="codehilite"><code># 把one的内容插入从three文件中通过&quot;测试&quot;匹配的“测试一下”后面，并打印出来
$ cat one
今天天气不错
挺风和日丽的
我们下午没有课
心情挺好的

$ cat three
测试一下

$ sed &quot;/测试/r one&quot; three
测试一下
今天天气不错
挺风和日丽的
我们下午没有课
心情挺好的
</code></pre>

<p><strong>5.</strong> 匹配一个文件的内容写入到另一个文件</p>
<pre class="codehilite"><code># 把从one中通过“今天”匹配的“今天天气不错”写入four
$ sed &quot;/今天/w four&quot; one
今天天气不错
挺风和日丽的
我们下午没有课
心情挺好的

$ cat four
今天天气不错
</code></pre>

<p><strong>6.</strong> 在匹配行后追加插入内容</p>
<pre class="codehilite"><code># 把“测试两下”插入到“今天”匹配的“今天天气不错”下面
$ sed &quot;/^今天/a测试两下&quot; one
今天天气不错
测试两下
挺风和日丽的
我们下午没有课
心情挺好的
</code></pre>

<p><strong>7.</strong> 读取一个文件的内容写入到另一个文件的匹配位置</p>
<pre class="codehilite"><code># 加“-i”会直接写入文件
$ sed -i &quot;/测试/r one&quot; three
$ cat one
今天天气不错
挺风和日丽的
我们下午没有课
心情挺好的
$ cat three
测试一下
今天天气不错
挺风和日丽的
我们下午没有课
心情挺好的
</code></pre>

<p><strong>8.</strong> 用s///直接替换字符串</p>
<pre class="codehilite"><code>$ sed &quot;s/今天/昨天/&quot; one
昨天天气不错
挺风和日丽的
我们下午没有课
心情挺好的
</code></pre>

<p><strong>9.</strong> 分别用first~step语法和命令n语法打印奇数行</p>
<pre class="codehilite"><code>$ cat -n one
     1  今天天气不错
     2  挺风和日丽的
     3  我们下午没有课
     4  心情挺好的
$ sed -n &quot;1~2p&quot; one
今天天气不错
我们下午没有课



$ cat -n one
     1  今天天气不错
     2  挺风和日丽的
     3  我们下午没有课
     4  心情挺好的
$ sed -n &quot;p;n&quot; one
今天天气不错
我们下午没有课
</code></pre>

<p><strong>10.</strong> 分别用first~step语法和命令n语法打印偶数行</p>
<pre class="codehilite"><code>$ cat -n one
     1  今天天气不错
     2  挺风和日丽的
     3  我们下午没有课
     4  心情挺好的
$ sed -n &quot;2~2p&quot; one
挺风和日丽的
心情挺好的



$ cat -n one
     1  今天天气不错
     2  挺风和日丽的
     3  我们下午没有课
     4  心情挺好的
$ sed -n &quot;n;p&quot; one
挺风和日丽的
心情挺好的
</code></pre>

<h3 id="4-awk">4. 三剑客之awk</h3>
<p><code>awk</code> 是一个处理文本的编程语言工具，能用简短的程序处理标准输入或文件、数据排序、计算以及生成报表等等。</p>
<p><strong>命令格式</strong>：<code>awk option 'pattern {action}' file</code></p>
<ul>
<li>其中pattern表示AWK在数据中查找的内容，而action是在找到匹配内容时所执行的一系列命令。花括号用于根据特定的模式对一系列指令进行分组。</li>
</ul>
<p>awk处理的工作方式与数据库类似，支持对记录和字段处理，这也是grep和sed不能实现的。</p>
<p>在awk中，缺省的情况下将文本文件中的一行视为一个记录，逐行放到内存中处理，而将一行中的某一部分作为记录中的一个字段。用1,2,3...数字的方式顺序的表示行（记录）中的不同字段。用\$后跟数字，引用对应的字段，以逗号分隔，0表示整个行。</p>
<h4 id="41">4.1. 常用参数</h4>
<p><strong>1. 选项</strong></p>
<ul>
<li>
<p>-f program-file：从文件中读取awk程序源文件；</p>
</li>
<li>
<p>-F fs：指定fs为输入字段分隔符；</p>
</li>
<li>
<p>-v var=value：变量赋值；</p>
</li>
<li>
<p>--posix：兼容POSIX正则表达式；</p>
</li>
<li>
<p>--dump-variables=[file]：把awk命令时的全局变量写入文件，默认文件是awkvars.out；</p>
</li>
<li>
<p>--profile=[file]：格式化awk语句到文件，默认是awkprof.out。</p>
</li>
</ul>
<p><strong>2. 常用模式</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>Pattern</strong></th>
<th style="text-align: left;"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">BEGIN{ }</td>
<td style="text-align: left;">给程序赋予初始状态，先执行的工作</td>
</tr>
<tr>
<td style="text-align: left;">END{ }</td>
<td style="text-align: left;">程序结束之后执行的一些扫尾工作</td>
</tr>
<tr>
<td style="text-align: left;">/regular expression/</td>
<td style="text-align: left;">为每个输入记录匹配正则表达式</td>
</tr>
<tr>
<td style="text-align: left;">pattern &amp;&amp; pattern</td>
<td style="text-align: left;">逻辑and，满足两个模式</td>
</tr>
<tr>
<td style="text-align: left;">pattern</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">! pattern</td>
<td style="text-align: left;">逻辑not，不满足模式</td>
</tr>
<tr>
<td style="text-align: left;">pattern1, pattern2</td>
<td style="text-align: left;">范围模式，匹配所有模式1的记录，直到匹配到模式2</td>
</tr>
</tbody>
</table>
<h4 id="42">4.2. 示例</h4>
<p><strong>1.</strong> 从文件读取awk程序处理文件</p>
<pre class="codehilite"><code>$ nano test.awk
{print $2}
$ tail -n3 /etc/services |awk -f test.awk
60179/tcp

Local
</code></pre>

<p><strong>2.</strong> 指定分隔符，打印指定字段，默认以空格分隔</p>
<pre class="codehilite"><code>$ tail -n3 /etc/services |awk '{print $2}'
60179/tcp

Local
</code></pre>

<p><strong>3.</strong> 指定冒号为分隔符打印</p>
<pre class="codehilite"><code># 这里要用单印号
$ tail -n5 /etc/passwd | awk -F ':' '{print $1}'
polkitd
rtkit
colord
poo
sshd
</code></pre>

<h4 id="43-beginend">4.3. BEGIN和END</h4>
<p><strong>语法结构:</strong> <code>awk 'BEGIN{ print "start" } pattern{ commands } END { print "end" }' filename</code> ，BEGIN语句+模式匹配+END语句三个部分组成，这三个部分都是可选项。</p>
<p><strong>工作原理</strong></p>
<ul>
<li>
<p>第一步执行BEGIN语句；</p>
</li>
<li>
<p>第二步从文件或标准输入读取一行，然后再执行行pattern语句，逐行扫描文件到文件全部被读取；</p>
</li>
<li>
<p>第三步执行END语句。</p>
</li>
</ul>
<p><strong>示例</strong></p>
<p><strong>1.</strong> 通过print参数打印</p>
<pre class="codehilite"><code>$ echo &quot;hello&quot; | awk 'BEGIN{print &quot;welcome&quot;} {print} END{print &quot;this is a test of awk&quot;}'
welcome
hello
this is a test of awk
</code></pre>

<p><strong>2.</strong> 初始化标题打印</p>
<pre class="codehilite"><code>$ tail /etc/services | awk 'BEGIN{print &quot;Service\t\tPort\t\t\tDescription\n&quot;}{print $0}'
Service         Port                    Description

sgi-cad         17004/tcp                       # Cluster Admin daemon
binkp           24554/tcp                       # binkp fidonet protocol
asp             27374/tcp                       # Address Search Protocol
asp             27374/udp
csync2          30865/tcp                       # cluster synchronization tool
dircproxy       57000/tcp                       # Detachable IRC Proxy
tfido           60177/tcp                       # fidonet EMSI over telnet
fido            60179/tcp                       # fidonet EMSI over TCP

# Local services
</code></pre>

<p><strong>3.</strong> 使用print逗号分隔时，打印则是以空格分界</p>
<pre class="codehilite"><code>$ echo | awk '{a=&quot;This is&quot;; b=&quot;a test&quot;; c=&quot;of awk&quot;;print a,b,c}'

This is a test of awk
</code></pre>

<h4 id="44">4.4. 内置变量</h4>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>变量名</strong></th>
<th style="text-align: left;"><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">$0</td>
<td style="text-align: left;">当前记录</td>
</tr>
<tr>
<td style="text-align: left;">$1~$n</td>
<td style="text-align: left;">当前记录的第N个字段</td>
</tr>
<tr>
<td style="text-align: left;">FS</td>
<td style="text-align: left;">输入字段分隔符（-F作用相同）默认空格</td>
</tr>
<tr>
<td style="text-align: left;">OFS</td>
<td style="text-align: left;">输出字段分隔符，默认是空格</td>
</tr>
<tr>
<td style="text-align: left;">RS</td>
<td style="text-align: left;">输入记录分隔符，默认换行符\n</td>
</tr>
<tr>
<td style="text-align: left;">ORS</td>
<td style="text-align: left;">输出记录分隔符，默认是换行符\n</td>
</tr>
<tr>
<td style="text-align: left;">NF</td>
<td style="text-align: left;">字段个数/列个数</td>
</tr>
<tr>
<td style="text-align: left;">NR</td>
<td style="text-align: left;">统计记录编号，每处理一行记录，编号就会+1</td>
</tr>
<tr>
<td style="text-align: left;">FNR</td>
<td style="text-align: left;">统计记录编号，每处理一行记录，编号也会+1，与NR不同的是，处理第二个文件时，编号会重新计数</td>
</tr>
<tr>
<td style="text-align: left;">OFS</td>
<td style="text-align: left;">输出字段分隔符，默认空格</td>
</tr>
<tr>
<td style="text-align: left;">IGNORECASE</td>
<td style="text-align: left;">忽略大小写</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<p><strong>1.</strong> FS</p>
<p>创建带空格的测试文件，查看前赋值FS变量，改变默认分空隔符为冒号。</p>
<pre class="codehilite"><code>$ cat test1.awk
aa:bb:cc
dd:ee:ff
$ awk 'BEGIN{FS=&quot;:&quot;}{print $1,$2,$3}' test1.awk
aa bb cc
dd ee ff
</code></pre>

<p><strong>2.</strong> OFS，<code>OFS</code> 可以理解为 <code>FS</code> 的逆向过程，即将输出字段的分隔符改为空格</p>
<p>创建带：的测试文件，查看前赋值 <code>OFS</code> 变量，改变默认：隔符为空格。</p>
<pre class="codehilite"><code>$ cat test2.awk
aa bb cc
dd ee ff
$ awk 'BEGIN{OFS=&quot;:&quot;}{print $1,$2,$3}' test2.awk
aa:bb:cc
dd:ee:ff
</code></pre>

<p><strong>3.</strong> RS，匹配分隔符号，默认以\n分隔每行</p>
<p>将/替换为换行（\n）输出：</p>
<pre class="codehilite"><code>$ echo &quot;RS/test/of/awk&quot; | awk 'BEGIN{RS=&quot;/&quot;}{print $0}'
RS
test
of
awk
</code></pre>

<p><strong>4.</strong> ORS，匹配每个记录的换行符（\n）,替换为指定的符号</p>
<p>将换行（\n）替换为+：</p>
<pre class="codehilite"><code>$ seq 10 | awk 'BEGIN{ORS=&quot;+&quot;}{print $0} END{print &quot;\n&quot;}'

1+2+3+4+5+6+7+8+9+10+
</code></pre>

<p><strong>5.</strong> NF，字段个数/列个数</p>
<p>打印字段个数：</p>
<pre class="codehilite"><code>$ echo &quot;a b c d e f&quot; | awk '{print NF}'

6
</code></pre>

<p>打印最后一个字段：</p>
<pre class="codehilite"><code>$ echo &quot;a b c d e f&quot; | awk '{print $NF}'

f
</code></pre>

<p>打印倒数第二个字段：</p>
<pre class="codehilite"><code>$ echo &quot;a b c d e f&quot; | awk '{print $(NF-1)}'
e
</code></pre>

<p>排除最后两个字段：</p>
<pre class="codehilite"><code>$ echo &quot;a b c d e f&quot; | awk '{$NF=&quot;&quot;;$(NF-1)=&quot;&quot;;print $0}'
a b c d
</code></pre>

<p>排除第一个字段：</p>
<pre class="codehilite"><code>$ echo &quot;a b c d e f&quot; | awk '{$1=&quot;&quot;;print $0}'
 b c d e f
</code></pre>

<h4 id="45">4.5. 运算符</h4>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>运算符</strong></th>
<th style="text-align: left;"><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">（....）</td>
<td style="text-align: left;">分组</td>
</tr>
<tr>
<td style="text-align: left;">$</td>
<td style="text-align: left;">字段引用</td>
</tr>
<tr>
<td style="text-align: left;">++ --</td>
<td style="text-align: left;">递增和递减</td>
</tr>
<tr>
<td style="text-align: left;">+ - !</td>
<td style="text-align: left;">加号，减号，和逻辑否定</td>
</tr>
<tr>
<td style="text-align: left;">* / %</td>
<td style="text-align: left;">乘，除和取余</td>
</tr>
<tr>
<td style="text-align: left;">+ -</td>
<td style="text-align: left;">加法，减法</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">&lt; &gt; &lt;= &gt;= != ==</td>
<td style="text-align: left;">关系运算符</td>
</tr>
<tr>
<td style="text-align: left;">~ !~</td>
<td style="text-align: left;">正则表达式匹配，否定正则表达式匹配</td>
</tr>
<tr>
<td style="text-align: left;">in</td>
<td style="text-align: left;">数组成员</td>
</tr>
<tr>
<td style="text-align: left;">&amp;&amp;</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">?:</td>
<td style="text-align: left;">简写条件表达式：expr1 ? expr2 : expr3第一个表达式为真，执行expr2，否则执行expr3</td>
</tr>
<tr>
<td style="text-align: left;">= += -= *= /= %= ^=</td>
<td style="text-align: left;">变量赋值运算符</td>
</tr>
</tbody>
</table>
<p>示例:</p>
<p><strong>1.</strong> 求和</p>
<pre class="codehilite"><code>$ awk 'BEGIN{a=2;b=3; print a+b }'

5
</code></pre>

<p><strong>2.</strong> 感叹号 否定匹配</p>
<pre class="codehilite"><code>$ tail /etc/services |awk '!/blp5/{print $0}'

sgi-cad         17004/tcp                       # Cluster Admin daemon
binkp           24554/tcp                       # binkp fidonet protocol
asp             27374/tcp                       # Address Search Protocol
asp             27374/udp
csync2          30865/tcp                       # cluster synchronization tool
dircproxy       57000/tcp                       # Detachable IRC Proxy
tfido           60177/tcp                       # fidonet EMSI over telnet
fido            60179/tcp                       # fidonet EMSI over TCP

# Local services
</code></pre>

<p><strong>3.</strong> 求余</p>
<p>打印偶数行</p>
<pre class="codehilite"><code>$ seq 5 |awk '$0%2==0{print $0}'

2
4
</code></pre>

<p>打印奇数行</p>
<pre class="codehilite"><code>$ seq 5 |awk '$0%2!=0{print $0}'
1
3
5
</code></pre>

<p><strong>4.</strong> 正则表达式匹配</p>
<pre class="codehilite"><code>$ seq 5 |awk '$0%2!=0{print $0}'
1
3
5

$ seq 5 |awk '$0!~/[34]/{print $0}'
1
2
5

$ seq 5 |awk '$0!~/[^34]/{print $0}'
3
4
</code></pre>

<p><strong>5.</strong> ?: 条件表达式，也叫三目运算</p>
<pre class="codehilite"><code>$ awk 'BEGIN{print 1==1?&quot;yes&quot;:&quot;no&quot;}'
yes

$ awk 'BEGIN{print 1==2?&quot;yes&quot;:&quot;no&quot;}'
no
</code></pre>

<p><strong>6.</strong> 变量赋值</p>
<pre class="codehilite"><code>$ seq 5 |awk '{sum+=$0}END{print sum}'

15
</code></pre>

<p><strong>6. 流程控制</strong></p>
<ul>
<li><code>if</code> 语句</li>
</ul>
<p><strong>格式：</strong><code>if (condition) statement [ else statement ]</code></p>
<pre class="codehilite"><code>$ seq 5 |awk '{if($0==3)print $0}'
3

$ seq 5 |awk '{if($0==3)print $0;else print &quot;no&quot;}'
no
no
3
no
no
</code></pre>

<ul>
<li><code>while</code> 语句</li>
</ul>
<p><strong>格式：</strong><code>while (condition) statement</code></p>
<p>遍历打印所有字段。</p>
<pre class="codehilite"><code class="language-Shell">$ awk '{i=1;while(i&lt;=NF){print $i;i++}}' one

今天天气不错
挺风和日丽的
我们下午没有课
心情挺好的
</code></pre>

<ul>
<li><code>for</code> 语句</li>
</ul>
<p><strong>格式：</strong><code>for (expr1; expr2; expr3) statement</code></p>
<p>遍历打印所有字段。</p>
<pre class="codehilite"><code class="language-Shell">$ awk '{for(i=1;i&lt;=NF;i++)print $i}' one

今天天气不错
挺风和日丽的
我们下午没有课
心情挺好的
</code></pre>

<ul>
<li><code>break</code> 和 <code>continue</code> 语句</li>
</ul>
<p><code>break</code> 跳过所有循环，<code>continue</code> 跳过当前循环。</p>
<pre class="codehilite"><code class="language-Shell">$ awk 'BEGIN{for(i=1;i&lt;=5;i++){if(i==3){break};print i}}'
1
2

$ awk 'BEGIN{for(i=1;i&lt;=5;i++){if(i==3){continue};print i}}'
1
2
4
5
</code></pre>
        <div class="copyright">
          <ul>
            <li>本文作者：畄月寒</li>
            <li>本文链接：<a href="https://testpoo.github.io/shell三剑客简介.html">https://testpoo.github.io/shell三剑客简介.html</a></li>
            <li>版权声明：本铺所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans"> BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
          </ul>
        </div>
      </div>
    </div>
    <input class="pswitch ponoff" type="checkbox" id="nvacatalog">
    <div class="nav">
      <ul>
        
        <li><a href="https://testpoo.github.io/关于我.html"><span><label style="color: #38b6fd"></label>&nbsp;关于我</span></a></li>
        
        <li><a href="https://testpoo.github.io/网址集.html"><span><label style="color: #38b6fd"></label>&nbsp;网址集</span></a></li>
        
        <li><a href="https://testpoo.github.io/问题集.html"><span><label style="color: #38b6fd"></label>&nbsp;问题集</span></a></li>
        
        <li><a href="https://testpoo.github.io/安装dockerswarm.html"><span><label style="color: #38b6fd"></label>&nbsp;安装dockerswarm</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian+sway安装设置.html"><span><label style="color: #38b6fd"></label>&nbsp;debian+sway安装设置</span></a></li>
        
        <li><a href="https://testpoo.github.io/人生的最高境界.html"><span><label style="color: #38b6fd"></label>&nbsp;人生的最高境界</span></a></li>
        
        <li><a href="https://testpoo.github.io/中国朝代顺序口诀.html"><span><label style="color: #38b6fd"></label>&nbsp;中国朝代顺序口诀</span></a></li>
        
        <li><a href="https://testpoo.github.io/国际象棋棋子代号.html"><span><label style="color: #38b6fd"></label>&nbsp;国际象棋棋子代号</span></a></li>
        
        <li><a href="https://testpoo.github.io/CSS代码小抄.html"><span><label style="color: #38b6fd"></label>&nbsp;CSS代码小抄</span></a></li>
        
        <li><a href="https://testpoo.github.io/婚书两则.html"><span><label style="color: #38b6fd"></label>&nbsp;婚书两则</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian安装设置.html"><span><label style="color: #38b6fd"></label>&nbsp;debian安装设置</span></a></li>
        
        <li><a href="https://testpoo.github.io/javascript代码小抄.html"><span><label style="color: #38b6fd"></label>&nbsp;javascript代码小抄</span></a></li>
        
        <li><a href="https://testpoo.github.io/python代码小抄.html"><span><label style="color: #38b6fd"></label>&nbsp;python代码小抄</span></a></li>
        
        <li><a href="https://testpoo.github.io/只有一个读音的九篇古文.html"><span><label style="color: #38b6fd"></label>&nbsp;只有一个读音的九篇古文</span></a></li>
        
        <li><a href="https://testpoo.github.io/独孤羊放妻春条书.html"><span><label style="color: #38b6fd"></label>&nbsp;独孤羊放妻春条书</span></a></li>
        
        <li><a href="https://testpoo.github.io/Arch通过archinstall安装过程.html"><span><label style="color: #38b6fd"></label>&nbsp;Arch通过archinstall安装过程</span></a></li>
        
        <li><a href="https://testpoo.github.io/Jinja2简介.html"><span><label style="color: #38b6fd"></label>&nbsp;Jinja2简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/shell三剑客简介.html"><span><label style="color: #38b6fd"></label>&nbsp;shell三剑客简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/Python造假数据神器Faker.html"><span><label style="color: #38b6fd"></label>&nbsp;Python造假数据神器Faker</span></a></li>
        
        <li><a href="https://testpoo.github.io/FastApi简析.html"><span><label style="color: #38b6fd"></label>&nbsp;FastApi简析</span></a></li>
        
        <li><a href="https://testpoo.github.io/go测试库apitest简介.html"><span><label style="color: #38b6fd"></label>&nbsp;go测试库apitest简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/go入门.html"><span><label style="color: #38b6fd"></label>&nbsp;go入门</span></a></li>
        
        <li><a href="https://testpoo.github.io/Arch手动安装过程.html"><span><label style="color: #38b6fd"></label>&nbsp;Arch手动安装过程</span></a></li>
        
        <li><a href="https://testpoo.github.io/BeautifulSoup简介.html"><span><label style="color: #38b6fd"></label>&nbsp;BeautifulSoup简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/tkinter教程.html"><span><label style="color: #38b6fd"></label>&nbsp;tkinter教程</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian+openbox安装过程.html"><span><label style="color: #38b6fd"></label>&nbsp;debian+openbox安装过程</span></a></li>
        
        <li><a href="https://testpoo.github.io/面试问答.html"><span><label style="color: #38b6fd"></label>&nbsp;面试问答</span></a></li>
        
        <li><a href="https://testpoo.github.io/UI自动化测试神器-Cypress.html"><span><label style="color: #38b6fd"></label>&nbsp;UI自动化测试神器-Cypress</span></a></li>
        
        <li><a href="https://testpoo.github.io/如何用自动化测试搞垮团队.html"><span><label style="color: #38b6fd"></label>&nbsp;如何用自动化测试搞垮团队</span></a></li>
        
        <li><a href="https://testpoo.github.io/mysql函数汇总.html"><span><label style="color: #38b6fd"></label>&nbsp;mysql函数汇总</span></a></li>
        
        <li><a href="https://testpoo.github.io/shell简介.html"><span><label style="color: #38b6fd"></label>&nbsp;shell简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/Docker入门教程.html"><span><label style="color: #38b6fd"></label>&nbsp;Docker入门教程</span></a></li>
        
        <li><a href="https://testpoo.github.io/性能监控各指令详解.html"><span><label style="color: #38b6fd"></label>&nbsp;性能监控各指令详解</span></a></li>
        
        <li><a href="https://testpoo.github.io/Python进阶.html"><span><label style="color: #38b6fd"></label>&nbsp;Python进阶</span></a></li>
        
        <li><a href="https://testpoo.github.io/Git简介.html"><span><label style="color: #38b6fd"></label>&nbsp;Git简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/Python正则表达式.html"><span><label style="color: #38b6fd"></label>&nbsp;Python正则表达式</span></a></li>
        
        <li><a href="https://testpoo.github.io/nose简介.html"><span><label style="color: #38b6fd"></label>&nbsp;nose简介</span></a></li>
        
        <li><a href="https://testpoo.github.io/Python自动化之unittest.html"><span><label style="color: #38b6fd"></label>&nbsp;Python自动化之unittest</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian+i3安装过程.html"><span><label style="color: #38b6fd"></label>&nbsp;debian+i3安装过程</span></a></li>
        
        <li><a href="https://testpoo.github.io/mysql的安装.html"><span><label style="color: #38b6fd"></label>&nbsp;mysql的安装</span></a></li>
        
        <li><a href="https://testpoo.github.io/紫薇斗数解析.html"><span><label style="color: #38b6fd"></label>&nbsp;紫薇斗数解析</span></a></li>
        
        <li><a href="https://testpoo.github.io/分分种学会python3.html"><span><label style="color: #38b6fd"></label>&nbsp;分分种学会python3</span></a></li>
        
        <li><a href="https://testpoo.github.io/Markdown笔记.html"><span><label style="color: #38b6fd"></label>&nbsp;Markdown笔记</span></a></li>
        
        <li><a href="https://testpoo.github.io/Linux下SVN服务器的搭建.html"><span><label style="color: #38b6fd"></label>&nbsp;Linux下SVN服务器的搭建</span></a></li>
        
        <li><a href="https://testpoo.github.io/mysql笔记.html"><span><label style="color: #38b6fd"></label>&nbsp;mysql笔记</span></a></li>
        
        <li><a href="https://testpoo.github.io/python标准异常.html"><span><label style="color: #38b6fd"></label>&nbsp;python标准异常</span></a></li>
        
        <li><a href="https://testpoo.github.io/svn命令全解.html"><span><label style="color: #38b6fd"></label>&nbsp;svn命令全解</span></a></li>
        
        <li><a href="https://testpoo.github.io/debian命令apt和dpkg用法.html"><span><label style="color: #38b6fd"></label>&nbsp;debian命令apt和dpkg用法</span></a></li>
        
      </ul>
    </div>
  </body>

  </html>